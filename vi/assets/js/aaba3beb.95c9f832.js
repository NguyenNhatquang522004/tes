"use strict";(globalThis.webpackChunkuip_urban_intelligence_platform_docs=globalThis.webpackChunkuip_urban_intelligence_platform_docs||[]).push([[8776],{1415:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>c,toc:()=>a});const c=JSON.parse('{"id":"frontend/services/websocket","title":"WebSocket Service","description":"Real-time bidirectional communication client with auto-reconnection","source":"@site/docs/frontend/services/websocket.md","sourceDirName":"frontend/services","slug":"/frontend/services/websocket","permalink":"/tes/vi/docs/frontend/services/websocket","draft":false,"unlisted":false,"editUrl":"https://github.com/NguyenNhatquang522004/UIP-Urban_Intelligence_Platform/tree/main/apps/traffic-web-app/frontend/docs/docs/frontend/services/websocket.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"WebSocket Service","description":"Real-time bidirectional communication client with auto-reconnection"}}');var i=r(4848),s=r(8453);const t={sidebar_position:4,title:"WebSocket Service",description:"Real-time bidirectional communication client with auto-reconnection"},d="WebSocket Service",l={},a=[{value:"Overview",id:"overview",level:2},{value:"Class API",id:"class-api",level:2},{value:"Constructor",id:"constructor",level:3},{value:"connect()",id:"connect",level:3},{value:"disconnect()",id:"disconnect",level:3},{value:"registerHandler()",id:"registerhandler",level:3},{value:"Message Types",id:"message-types",level:2},{value:"Connection Lifecycle",id:"connection-lifecycle",level:2},{value:"Usage",id:"usage",level:2},{value:"Singleton Instance",id:"singleton-instance",level:2},{value:"Message Handling",id:"message-handling",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"See Also",id:"see-also",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:["\n",(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"websocket-service",children:"WebSocket Service"})}),"\n",(0,i.jsx)(n.p,{children:"Service class managing real-time bidirectional communication with the backend, including automatic reconnection, heartbeat, and message routing."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The WebSocketService provides:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Automatic reconnection with exponential backoff"}),"\n",(0,i.jsx)(n.li,{children:"Heartbeat mechanism for connection health"}),"\n",(0,i.jsx)(n.li,{children:"Topic-based message routing"}),"\n",(0,i.jsx)(n.li,{children:"Connection state management"}),"\n",(0,i.jsx)(n.li,{children:"Manual connect/disconnect controls"}),"\n",(0,i.jsx)(n.li,{children:"Message handler registration"}),"\n",(0,i.jsx)(n.li,{children:"Integration with Zustand store"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mermaid",children:"graph TD\r\n    A[WebSocketService] --\x3e B[WebSocket Connection]\r\n    A --\x3e C[Reconnection Manager]\r\n    A --\x3e D[Heartbeat System]\r\n    A --\x3e E[Message Router]\r\n    \r\n    B --\x3e F[ws://localhost:5000]\r\n    \r\n    C --\x3e G[scheduleReconnect]\r\n    C --\x3e H[5s Interval]\r\n    \r\n    D --\x3e I[10s Heartbeat]\r\n    \r\n    E --\x3e J[handleMessage]\r\n    J --\x3e K[initial]\r\n    J --\x3e L[camera_update]\r\n    J --\x3e M[weather_update]\r\n    J --\x3e N[aqi_update]\r\n    J --\x3e O[accident_alert]\r\n    \r\n    K --\x3e P[Traffic Store]\r\n    L --\x3e P\r\n    M --\x3e P\r\n    N --\x3e P\r\n    O --\x3e P\n"})}),"\n",(0,i.jsx)(n.h2,{id:"class-api",children:"Class API"}),"\n",(0,i.jsx)(n.h3,{id:"constructor",children:"Constructor"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"class WebSocketService {\r\n    private ws: WebSocket | null = null;\r\n    private reconnectInterval: number = 5000;\r\n    private url: string;\r\n\r\n    constructor() {\r\n        this.url = import.meta.env.VITE_WS_URL || 'ws://localhost:5000';\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"connect",children:"connect()"}),"\n",(0,i.jsx)(n.p,{children:"Establish WebSocket connection."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"connect(): void\n"})}),"\n",(0,i.jsx)(n.p,{children:"Features:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Prevents duplicate connections"}),"\n",(0,i.jsx)(n.li,{children:"Sets up event handlers (onopen, onmessage, onerror, onclose)"}),"\n",(0,i.jsx)(n.li,{children:"Starts heartbeat on successful connection"}),"\n",(0,i.jsx)(n.li,{children:"Updates store connection status"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"disconnect",children:"disconnect()"}),"\n",(0,i.jsx)(n.p,{children:"Gracefully close WebSocket connection."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"disconnect(): void\n"})}),"\n",(0,i.jsx)(n.p,{children:"Features:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Marks as intentional close (prevents reconnection)"}),"\n",(0,i.jsx)(n.li,{children:"Clears reconnect timers"}),"\n",(0,i.jsx)(n.li,{children:"Stops heartbeat"}),"\n",(0,i.jsx)(n.li,{children:"Closes WebSocket"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"registerhandler",children:"registerHandler()"}),"\n",(0,i.jsx)(n.p,{children:"Register a custom message handler for a specific type."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"registerHandler(type: string, handler: (data: any) => void): void\n"})}),"\n",(0,i.jsx)(n.h2,{id:"message-types",children:"Message Types"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Store Action"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"initial"})}),(0,i.jsx)(n.td,{children:"Initial data snapshot"}),(0,i.jsx)(n.td,{children:"Multiple setters"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"camera_update"})}),(0,i.jsx)(n.td,{children:"Camera status changes"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"addCamera()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"weather_update"})}),(0,i.jsx)(n.td,{children:"Weather observations"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"addWeather()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"aqi_update"})}),(0,i.jsx)(n.td,{children:"Air quality readings"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"addAirQuality()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"new_accident"})}),(0,i.jsx)(n.td,{children:"New accident detected"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"addAccident()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"pattern_change"})}),(0,i.jsx)(n.td,{children:"Traffic pattern updates"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"addPattern()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"accident_alert"})}),(0,i.jsx)(n.td,{children:"High-priority accident"}),(0,i.jsx)(n.td,{children:"Notification"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"aqi_warning"})}),(0,i.jsx)(n.td,{children:"High AQI warning"}),(0,i.jsx)(n.td,{children:"Notification"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"connection-lifecycle",children:"Connection Lifecycle"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mermaid",children:"stateDiagram-v2\r\n    [*] --\x3e Disconnected\r\n    Disconnected --\x3e Connecting: connect()\r\n    Connecting --\x3e Connected: onopen\r\n    Connecting --\x3e Disconnected: onerror\r\n    Connected --\x3e Disconnected: onclose\r\n    Disconnected --\x3e Connecting: scheduleReconnect\r\n    Connected --\x3e [*]: disconnect()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { wsService } from './services/websocket';\r\n\r\n// In Dashboard component\r\nuseEffect(() => {\r\n    wsService.connect();\r\n    return () => wsService.disconnect();\r\n}, []);\r\n\r\n// Register custom handler\r\nwsService.registerHandler('custom_event', (data) => {\r\n    console.log('Custom event received:', data);\r\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"singleton-instance",children:"Singleton Instance"}),"\n",(0,i.jsx)(n.p,{children:"The service exports a singleton instance:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export const wsService = new WebSocketService();\n"})}),"\n",(0,i.jsx)(n.h2,{id:"message-handling",children:"Message Handling"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"private handleMessage(message: WebSocketMessage): void {\r\n    const store = useTrafficStore.getState();\r\n\r\n    switch (message.type) {\r\n        case 'initial':\r\n            if (message.data?.cameras) {\r\n                message.data.cameras.forEach(store.addCamera);\r\n            }\r\n            // ... other data types\r\n            break;\r\n\r\n        case 'camera_update':\r\n            if (Array.isArray(message.data)) {\r\n                message.data.forEach(store.addCamera);\r\n            }\r\n            break;\r\n\r\n        // ... more cases\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Setting"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"url"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ws://localhost:5000"})}),(0,i.jsx)(n.td,{children:"WebSocket server URL"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"reconnectInterval"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"5000"})}),(0,i.jsx)(n.td,{children:"Reconnection delay (ms)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"heartbeatInterval"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"10000"})}),(0,i.jsx)(n.td,{children:"Heartbeat ping interval (ms)"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Native WebSocket API"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"useTrafficStore"}),": Zustand store for state updates"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WebSocketMessage"})," type from ",(0,i.jsx)(n.code,{children:"../types"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Connection errors trigger automatic reconnection"}),"\n",(0,i.jsx)(n.li,{children:"Message parse errors are logged but don't crash"}),"\n",(0,i.jsx)(n.li,{children:"Graceful handling of server disconnections"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/tes/vi/docs/frontend/hooks/useWebSocket",children:"useWebSocket Hook"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/tes/vi/docs/frontend/store/trafficStore",children:"Traffic Store"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/tes/vi/docs/frontend/components/ConnectionStatus",children:"ConnectionStatus Component"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>d});var c=r(6540);const i={},s=c.createContext(i);function t(e){const n=c.useContext(s);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),c.createElement(s.Provider,{value:n},e.children)}}}]);