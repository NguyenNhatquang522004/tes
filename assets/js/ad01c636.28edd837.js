"use strict";(globalThis.webpackChunkuip_urban_intelligence_platform_docs=globalThis.webpackChunkuip_urban_intelligence_platform_docs||[]).push([[1237],{7636:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>c,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"backend/utils/validators","title":"Validators - Input Validation","description":"Input validation utilities for request parameters, entity data, coordinates, and NGSI-LD compliance.","source":"@site/docs/backend/utils/validators.md","sourceDirName":"backend/utils","slug":"/backend/utils/validators","permalink":"/tes/docs/backend/utils/validators","draft":false,"unlisted":false,"editUrl":"https://github.com/NguyenNhatquang522004/UIP-Urban_Intelligence_Platform/tree/main/apps/traffic-web-app/frontend/docs/docs/backend/utils/validators.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"validators","title":"Validators - Input Validation","sidebar_label":"Validators","sidebar_position":4,"description":"Input validation utilities for request parameters, entity data, coordinates, and NGSI-LD compliance.","keywords":["validators","validation","input","sanitization","security","ngsi-ld"]}}');var a=r(4848),i=r(8453);const o={id:"validators",title:"Validators - Input Validation",sidebar_label:"Validators",sidebar_position:4,description:"Input validation utilities for request parameters, entity data, coordinates, and NGSI-LD compliance.",keywords:["validators","validation","input","sanitization","security","ngsi-ld"]},s="Validators - Input Validation",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Validation Functions",id:"validation-functions",level:2},{value:"Coordinate Validation",id:"coordinate-validation",level:3},{value:"Entity ID Validation",id:"entity-id-validation",level:3},{value:"Pagination Validation",id:"pagination-validation",level:3},{value:"Date Range Validation",id:"date-range-validation",level:3},{value:"Bounding Box Validation",id:"bounding-box-validation",level:3},{value:"Validation Middleware",id:"validation-middleware",level:2},{value:"Request Body Validation",id:"request-body-validation",level:2},{value:"Related Documentation",id:"related-documentation",level:2},{value:"References",id:"references",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"validators---input-validation",children:"Validators - Input Validation"})}),"\n",(0,a.jsxs)(n.p,{children:["Input validation utilities for ",(0,a.jsx)(n.strong,{children:"request parameters"}),", entity data, coordinates, and NGSI-LD compliance."]}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-mermaid",children:"graph LR\r\n    A[Request] --\x3e B[Validators]\r\n    B --\x3e C{Valid?}\r\n    C --\x3e|Yes| D[Route Handler]\r\n    C --\x3e|No| E[400 Error]\n"})}),"\n",(0,a.jsx)(n.h2,{id:"validation-functions",children:"Validation Functions"}),"\n",(0,a.jsx)(n.h3,{id:"coordinate-validation",children:"Coordinate Validation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export function validateCoordinates(lat: any, lon: any): {\r\n  valid: boolean;\r\n  latitude?: number;\r\n  longitude?: number;\r\n  error?: string;\r\n} {\r\n  const latitude = parseFloat(lat);\r\n  const longitude = parseFloat(lon);\r\n  \r\n  if (isNaN(latitude) || isNaN(longitude)) {\r\n    return { valid: false, error: 'Invalid coordinate format' };\r\n  }\r\n  \r\n  if (latitude < -90 || latitude > 90) {\r\n    return { valid: false, error: 'Latitude must be between -90 and 90' };\r\n  }\r\n  \r\n  if (longitude < -180 || longitude > 180) {\r\n    return { valid: false, error: 'Longitude must be between -180 and 180' };\r\n  }\r\n  \r\n  return { valid: true, latitude, longitude };\r\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"entity-id-validation",children:"Entity ID Validation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export function validateEntityId(id: string): boolean {\r\n  // NGSI-LD URN format: urn:ngsi-ld:EntityType:id\r\n  const urnPattern = /^urn:ngsi-ld:[A-Za-z][A-Za-z0-9]*:[A-Za-z0-9\\-_]+$/;\r\n  return urnPattern.test(id);\r\n}\r\n\r\n// Usage\r\nif (!validateEntityId(req.params.id)) {\r\n  return res.status(400).json({\r\n    error: 'Invalid entity ID format. Expected: urn:ngsi-ld:Type:id'\r\n  });\r\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"pagination-validation",children:"Pagination Validation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export function validatePagination(query: any): {\r\n  limit: number;\r\n  offset: number;\r\n} {\r\n  const limit = Math.min(\r\n    Math.max(parseInt(query.limit) || 100, 1),\r\n    1000  // Max 1000\r\n  );\r\n  \r\n  const offset = Math.max(parseInt(query.offset) || 0, 0);\r\n  \r\n  return { limit, offset };\r\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"date-range-validation",children:"Date Range Validation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export function validateDateRange(from: string, to: string): {\r\n  valid: boolean;\r\n  fromDate?: Date;\r\n  toDate?: Date;\r\n  error?: string;\r\n} {\r\n  const fromDate = new Date(from);\r\n  const toDate = new Date(to);\r\n  \r\n  if (isNaN(fromDate.getTime())) {\r\n    return { valid: false, error: 'Invalid \"from\" date format' };\r\n  }\r\n  \r\n  if (isNaN(toDate.getTime())) {\r\n    return { valid: false, error: 'Invalid \"to\" date format' };\r\n  }\r\n  \r\n  if (fromDate > toDate) {\r\n    return { valid: false, error: '\"from\" date must be before \"to\" date' };\r\n  }\r\n  \r\n  // Max 90 days\r\n  const maxRange = 90 * 24 * 60 * 60 * 1000;\r\n  if (toDate.getTime() - fromDate.getTime() > maxRange) {\r\n    return { valid: false, error: 'Date range cannot exceed 90 days' };\r\n  }\r\n  \r\n  return { valid: true, fromDate, toDate };\r\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"bounding-box-validation",children:"Bounding Box Validation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export function validateBBox(bbox: string): {\r\n  valid: boolean;\r\n  bounds?: { minLat: number; minLon: number; maxLat: number; maxLon: number };\r\n  error?: string;\r\n} {\r\n  const parts = bbox.split(',').map(Number);\r\n  \r\n  if (parts.length !== 4 || parts.some(isNaN)) {\r\n    return { valid: false, error: 'Invalid bbox format. Expected: minLat,minLon,maxLat,maxLon' };\r\n  }\r\n  \r\n  const [minLat, minLon, maxLat, maxLon] = parts;\r\n  \r\n  if (minLat >= maxLat || minLon >= maxLon) {\r\n    return { valid: false, error: 'Invalid bbox: min values must be less than max values' };\r\n  }\r\n  \r\n  return {\r\n    valid: true,\r\n    bounds: { minLat, minLon, maxLat, maxLon }\r\n  };\r\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"validation-middleware",children:"Validation Middleware"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// middlewares/validate.ts\r\nimport { Request, Response, NextFunction } from 'express';\r\n\r\nexport function validateQuery(schema: object) {\r\n  return (req: Request, res: Response, next: NextFunction) => {\r\n    const errors: string[] = [];\r\n    \r\n    for (const [key, rules] of Object.entries(schema)) {\r\n      const value = req.query[key];\r\n      \r\n      if (rules.required && !value) {\r\n        errors.push(`Missing required parameter: ${key}`);\r\n        continue;\r\n      }\r\n      \r\n      if (value && rules.type === 'number') {\r\n        const num = Number(value);\r\n        if (isNaN(num)) {\r\n          errors.push(`${key} must be a number`);\r\n        }\r\n        if (rules.min !== undefined && num < rules.min) {\r\n          errors.push(`${key} must be at least ${rules.min}`);\r\n        }\r\n        if (rules.max !== undefined && num > rules.max) {\r\n          errors.push(`${key} must be at most ${rules.max}`);\r\n        }\r\n      }\r\n      \r\n      if (value && rules.enum && !rules.enum.includes(value)) {\r\n        errors.push(`${key} must be one of: ${rules.enum.join(', ')}`);\r\n      }\r\n    }\r\n    \r\n    if (errors.length > 0) {\r\n      return res.status(400).json({ errors });\r\n    }\r\n    \r\n    next();\r\n  };\r\n}\r\n\r\n// Usage\r\nrouter.get('/cameras/near',\r\n  validateQuery({\r\n    lat: { required: true, type: 'number', min: -90, max: 90 },\r\n    lon: { required: true, type: 'number', min: -180, max: 180 },\r\n    maxDistance: { type: 'number', min: 0, max: 100000 }\r\n  }),\r\n  cameraController.getNearby\r\n);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"request-body-validation",children:"Request Body Validation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export function validateAgentRequest(body: any): {\r\n  valid: boolean;\r\n  error?: string;\r\n} {\r\n  if (!body.message || typeof body.message !== 'string') {\r\n    return { valid: false, error: 'message is required and must be a string' };\r\n  }\r\n  \r\n  if (!body.location || typeof body.location !== 'object') {\r\n    return { valid: false, error: 'location object is required' };\r\n  }\r\n  \r\n  const coordResult = validateCoordinates(body.location.lat, body.location.lng);\r\n  if (!coordResult.valid) {\r\n    return { valid: false, error: coordResult.error };\r\n  }\r\n  \r\n  return { valid: true };\r\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/tes/docs/backend/middlewares/error-handler",children:"Error Handler"})," - Error responses"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/tes/docs/backend/routes/routes-overview",children:"Routes Overview"})," - API endpoints"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/tes/docs/backend/utils/logger",children:"Logger"})," - Validation logging"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://express-validator.github.io/docs/",children:"Express Validation"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html",children:"OWASP Input Validation"})}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>s});var t=r(6540);const a={},i=t.createContext(a);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);