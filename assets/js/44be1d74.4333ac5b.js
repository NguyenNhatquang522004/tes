"use strict";(globalThis.webpackChunkuip_urban_intelligence_platform_docs=globalThis.webpackChunkuip_urban_intelligence_platform_docs||[]).push([[9282],{3241:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>c,default:()=>o,frontMatter:()=>t,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"backend/routes/camera-routes","title":"Camera Routes","description":"RESTful API endpoints for querying traffic camera entities with geo-spatial filtering, image retrieval, and real-time traffic metrics.","source":"@site/docs/backend/routes/camera.md","sourceDirName":"backend/routes","slug":"/backend/routes/camera-routes","permalink":"/tes/docs/backend/routes/camera-routes","draft":false,"unlisted":false,"editUrl":"https://github.com/NguyenNhatquang522004/UIP-Urban_Intelligence_Platform/tree/main/apps/traffic-web-app/frontend/docs/docs/backend/routes/camera.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"camera-routes","title":"Camera Routes","sidebar_label":"Camera","sidebar_position":2,"description":"RESTful API endpoints for querying traffic camera entities with geo-spatial filtering, image retrieval, and real-time traffic metrics.","keywords":["camera","api","traffic","image","geo-spatial","ngsi-ld"]}}');var i=n(4848),a=n(8453);const t={id:"camera-routes",title:"Camera Routes",sidebar_label:"Camera",sidebar_position:2,description:"RESTful API endpoints for querying traffic camera entities with geo-spatial filtering, image retrieval, and real-time traffic metrics.",keywords:["camera","api","traffic","image","geo-spatial","ngsi-ld"]},c="Camera Routes",d={},l=[{value:"Base Path",id:"base-path",level:2},{value:"Endpoints Summary",id:"endpoints-summary",level:2},{value:"Endpoints",id:"endpoints",level:2},{value:"GET /api/cameras",id:"get-apicameras",level:3},{value:"GET /api/cameras/",id:"get-apicameras-1",level:3},{value:"GET /api/cameras/near",id:"get-apicamerasnear",level:3},{value:"GET /api/cameras/bbox",id:"get-apicamerasbbox",level:3},{value:"GET /api/cameras//image",id:"get-apicamerasimage",level:3},{value:"GET /api/cameras//metrics",id:"get-apicamerasmetrics",level:3},{value:"Haversine Distance Calculation",id:"haversine-distance-calculation",level:2},{value:"Data Flow",id:"data-flow",level:2},{value:"Related Documentation",id:"related-documentation",level:2},{value:"References",id:"references",level:2}];function h(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"camera-routes",children:"Camera Routes"})}),"\n",(0,i.jsxs)(r.p,{children:["RESTful API endpoints for querying ",(0,i.jsx)(r.strong,{children:"traffic camera entities"})," (TrafficFlowObserved) with geo-spatial filtering, image URL retrieval, and real-time traffic metrics."]}),"\n",(0,i.jsx)(r.h2,{id:"base-path",children:"Base Path"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"/api/cameras\n"})}),"\n",(0,i.jsx)(r.h2,{id:"endpoints-summary",children:"Endpoints Summary"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Method"}),(0,i.jsx)(r.th,{children:"Endpoint"}),(0,i.jsx)(r.th,{children:"Description"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"GET"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"/"})}),(0,i.jsx)(r.td,{children:"List all cameras"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"GET"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"/:id"})}),(0,i.jsx)(r.td,{children:"Get camera by ID"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"GET"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"/near"})}),(0,i.jsx)(r.td,{children:"Find cameras near location"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"GET"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"/bbox"})}),(0,i.jsx)(r.td,{children:"Get cameras in bounding box"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"GET"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"/:id/image"})}),(0,i.jsx)(r.td,{children:"Get camera image URL"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"GET"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"/:id/metrics"})}),(0,i.jsx)(r.td,{children:"Get traffic metrics"})]})]})]}),"\n",(0,i.jsx)(r.h2,{id:"endpoints",children:"Endpoints"}),"\n",(0,i.jsx)(r.h3,{id:"get-apicameras",children:"GET /api/cameras"}),"\n",(0,i.jsx)(r.p,{children:"List all cameras with optional filters."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Query Parameters:"})}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Parameter"}),(0,i.jsx)(r.th,{children:"Type"}),(0,i.jsx)(r.th,{children:"Default"}),(0,i.jsx)(r.th,{children:"Description"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"limit"})}),(0,i.jsx)(r.td,{children:"number"}),(0,i.jsx)(r.td,{children:"100"}),(0,i.jsx)(r.td,{children:"Maximum results"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"offset"})}),(0,i.jsx)(r.td,{children:"number"}),(0,i.jsx)(r.td,{children:"0"}),(0,i.jsx)(r.td,{children:"Skip N results"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"status"})}),(0,i.jsx)(r.td,{children:"string"}),(0,i.jsx)(r.td,{children:"-"}),(0,i.jsxs)(r.td,{children:["Filter: ",(0,i.jsx)(r.code,{children:"online"}),", ",(0,i.jsx)(r.code,{children:"offline"})]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"type"})}),(0,i.jsx)(r.td,{children:"string"}),(0,i.jsx)(r.td,{children:"-"}),(0,i.jsxs)(r.td,{children:["Filter: ",(0,i.jsx)(r.code,{children:"PTZ"}),", ",(0,i.jsx)(r.code,{children:"Static"}),", ",(0,i.jsx)(r.code,{children:"Dome"})]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"includeMetrics"})}),(0,i.jsx)(r.td,{children:"boolean"}),(0,i.jsx)(r.td,{children:"false"}),(0,i.jsx)(r.td,{children:"Include traffic metrics"})]})]})]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Response:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-json",children:'{\r\n  "success": true,\r\n  "data": [\r\n    {\r\n      "id": "urn:ngsi-ld:Camera:001",\r\n      "name": "Camera Nguyen Hue",\r\n      "location": {\r\n        "latitude": 10.7731,\r\n        "longitude": 106.7030\r\n      },\r\n      "imageUrl": "http://camera.hcmc.vn/001/live.jpg",\r\n      "status": "online",\r\n      "type": "PTZ",\r\n      "dateModified": "2025-01-15T10:30:00.000Z"\r\n    }\r\n  ],\r\n  "meta": {\r\n    "total": 520,\r\n    "limit": 100,\r\n    "offset": 0\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Example:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:'curl "http://localhost:5000/api/cameras?limit=10&status=online"\n'})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsxs)(r.h3,{id:"get-apicameras-1",children:["GET /api/cameras/",":id"]}),"\n",(0,i.jsx)(r.p,{children:"Get a specific camera by ID."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Path Parameters:"})}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Parameter"}),(0,i.jsx)(r.th,{children:"Type"}),(0,i.jsx)(r.th,{children:"Description"})]})}),(0,i.jsx)(r.tbody,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"id"})}),(0,i.jsx)(r.td,{children:"string"}),(0,i.jsxs)(r.td,{children:["Camera URN (e.g., ",(0,i.jsx)(r.code,{children:"urn:ngsi-ld:Camera:001"}),")"]})]})})]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Response:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-json",children:'{\r\n  "success": true,\r\n  "data": {\r\n    "id": "urn:ngsi-ld:Camera:001",\r\n    "name": "Camera Nguyen Hue",\r\n    "location": {\r\n      "latitude": 10.7731,\r\n      "longitude": 106.7030\r\n    },\r\n    "imageUrl": "http://camera.hcmc.vn/001/live.jpg",\r\n    "status": "online",\r\n    "roadSegment": "urn:ngsi-ld:RoadSegment:nguyen-hue",\r\n    "dateModified": "2025-01-15T10:30:00.000Z"\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Error Response (404):"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-json",children:'{\r\n  "success": false,\r\n  "error": {\r\n    "code": "NOT_FOUND",\r\n    "message": "Camera not found"\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h3,{id:"get-apicamerasnear",children:"GET /api/cameras/near"}),"\n",(0,i.jsx)(r.p,{children:"Find cameras near a geographic location using Haversine distance."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Query Parameters:"})}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Parameter"}),(0,i.jsx)(r.th,{children:"Type"}),(0,i.jsx)(r.th,{children:"Required"}),(0,i.jsx)(r.th,{children:"Description"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"lat"})}),(0,i.jsx)(r.td,{children:"number"}),(0,i.jsx)(r.td,{children:"Yes"}),(0,i.jsx)(r.td,{children:"Latitude (WGS84)"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"lon"})}),(0,i.jsx)(r.td,{children:"number"}),(0,i.jsx)(r.td,{children:"Yes"}),(0,i.jsx)(r.td,{children:"Longitude (WGS84)"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"maxDistance"})}),(0,i.jsx)(r.td,{children:"number"}),(0,i.jsx)(r.td,{children:"No"}),(0,i.jsx)(r.td,{children:"Search radius in meters (default: 5000)"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"limit"})}),(0,i.jsx)(r.td,{children:"number"}),(0,i.jsx)(r.td,{children:"No"}),(0,i.jsx)(r.td,{children:"Maximum results (default: 50)"})]})]})]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Response:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-json",children:'{\r\n  "success": true,\r\n  "data": [\r\n    {\r\n      "id": "urn:ngsi-ld:Camera:001",\r\n      "name": "Camera Nguyen Hue",\r\n      "location": {\r\n        "latitude": 10.7731,\r\n        "longitude": 106.7030\r\n      },\r\n      "distance": 250.5,\r\n      "imageUrl": "http://camera.hcmc.vn/001/live.jpg"\r\n    }\r\n  ],\r\n  "meta": {\r\n    "center": { "lat": 10.77, "lon": 106.70 },\r\n    "radius": 5000,\r\n    "found": 15\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Example:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:'curl "http://localhost:5000/api/cameras/near?lat=10.77&lon=106.70&maxDistance=2000"\n'})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h3,{id:"get-apicamerasbbox",children:"GET /api/cameras/bbox"}),"\n",(0,i.jsx)(r.p,{children:"Get cameras within a bounding box."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Query Parameters:"})}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Parameter"}),(0,i.jsx)(r.th,{children:"Type"}),(0,i.jsx)(r.th,{children:"Required"}),(0,i.jsx)(r.th,{children:"Description"})]})}),(0,i.jsx)(r.tbody,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"bbox"})}),(0,i.jsx)(r.td,{children:"string"}),(0,i.jsx)(r.td,{children:"Yes"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"minLat,minLon,maxLat,maxLon"})})]})})]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Example:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:'curl "http://localhost:5000/api/cameras/bbox?bbox=10.7,106.6,10.9,106.8"\n'})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsxs)(r.h3,{id:"get-apicamerasimage",children:["GET /api/cameras/",":id","/image"]}),"\n",(0,i.jsx)(r.p,{children:"Get the latest image URL for a camera."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Response:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-json",children:'{\r\n  "success": true,\r\n  "data": {\r\n    "cameraId": "urn:ngsi-ld:Camera:001",\r\n    "imageUrl": "http://camera.hcmc.vn/001/live.jpg?t=1705312200",\r\n    "capturedAt": "2025-01-15T10:30:00.000Z",\r\n    "resolution": "1920x1080"\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsxs)(r.h3,{id:"get-apicamerasmetrics",children:["GET /api/cameras/",":id","/metrics"]}),"\n",(0,i.jsx)(r.p,{children:"Get traffic metrics observed by the camera."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Response:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-json",children:'{\r\n  "success": true,\r\n  "data": {\r\n    "cameraId": "urn:ngsi-ld:Camera:001",\r\n    "observedAt": "2025-01-15T10:30:00.000Z",\r\n    "intensity": 85,\r\n    "occupancy": 0.65,\r\n    "averageSpeed": 35.5,\r\n    "vehicleCount": 42,\r\n    "congestionLevel": "moderate"\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(r.h2,{id:"haversine-distance-calculation",children:"Haversine Distance Calculation"}),"\n",(0,i.jsxs)(r.p,{children:["The ",(0,i.jsx)(r.code,{children:"/near"})," endpoint uses Haversine formula to calculate distances:"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"function haversineDistance(lat1: number, lng1: number, lat2: number, lng2: number): number {\r\n  const R = 6371000; // Earth radius in meters\r\n  const \u03c61 = (lat1 * Math.PI) / 180;\r\n  const \u03c62 = (lat2 * Math.PI) / 180;\r\n  const \u0394\u03c6 = ((lat2 - lat1) * Math.PI) / 180;\r\n  const \u0394\u03bb = ((lng2 - lng1) * Math.PI) / 180;\r\n\r\n  const a =\r\n    Math.sin(\u0394\u03c6 / 2) * Math.sin(\u0394\u03c6 / 2) +\r\n    Math.cos(\u03c61) * Math.cos(\u03c62) * Math.sin(\u0394\u03bb / 2) * Math.sin(\u0394\u03bb / 2);\r\n\r\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\r\n  return R * c;\r\n}\n"})}),"\n",(0,i.jsx)(r.h2,{id:"data-flow",children:"Data Flow"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-mermaid",children:"sequenceDiagram\r\n    participant Client\r\n    participant Route as cameraRoutes\r\n    participant Service as StellioService\r\n    participant Stellio\r\n    \r\n    Client->>Route: GET /api/cameras/near?lat=10.77&lon=106.70\r\n    Route->>Service: getCameras()\r\n    Service->>Stellio: GET /entities?type=Camera\r\n    Stellio--\x3e>Service: NGSI-LD entities\r\n    Service--\x3e>Route: Camera[]\r\n    Route->>Route: Filter by distance\r\n    Route->>Route: Sort by distance\r\n    Route--\x3e>Client: JSON response\n"})}),"\n",(0,i.jsx)(r.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/tes/docs/backend/services/stellio-service",children:"StellioService"})," - NGSI-LD entity queries"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/tes/docs/backend/services/websocket-service",children:"WebSocket"})," - Real-time camera updates"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/tes/docs/backend/services/generic-ngsi-service",children:"GenericNgsiService"})," - Config-driven entities"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"references",children:"References"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://smart-data-models.github.io/dataModel.Transportation/TrafficFlowObserved/",children:"NGSI-LD TrafficFlowObserved"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Haversine_formula",children:"Haversine Formula"})}),"\n"]})]})}function o(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>t,x:()=>c});var s=n(6540);const i={},a=s.createContext(i);function t(e){const r=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(a.Provider,{value:r},e.children)}}}]);