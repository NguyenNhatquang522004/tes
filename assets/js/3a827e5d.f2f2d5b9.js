"use strict";(globalThis.webpackChunkuip_urban_intelligence_platform_docs=globalThis.webpackChunkuip_urban_intelligence_platform_docs||[]).push([[8926],{7057:(n,r,t)=>{t.r(r),t.d(r,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>e,toc:()=>c});const e=JSON.parse('{"id":"backend/utils/transformations","title":"Transformations - Data Transformation Utilities","description":"Data transformation utilities for converting between NGSI-LD, GeoJSON, and frontend-friendly formats.","source":"@site/docs/backend/utils/transformations.md","sourceDirName":"backend/utils","slug":"/backend/utils/transformations","permalink":"/tes/docs/backend/utils/transformations","draft":false,"unlisted":false,"editUrl":"https://github.com/NguyenNhatquang522004/UIP-Urban_Intelligence_Platform/tree/main/apps/traffic-web-app/frontend/docs/docs/backend/utils/transformations.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"id":"transformations","title":"Transformations - Data Transformation Utilities","sidebar_label":"Transformations","sidebar_position":5,"description":"Data transformation utilities for converting between NGSI-LD, GeoJSON, and frontend-friendly formats.","keywords":["transformations","ngsi-ld","geojson","mapping","conversion"]}}');var i=t(4848),a=t(8453);const o={id:"transformations",title:"Transformations - Data Transformation Utilities",sidebar_label:"Transformations",sidebar_position:5,description:"Data transformation utilities for converting between NGSI-LD, GeoJSON, and frontend-friendly formats.",keywords:["transformations","ngsi-ld","geojson","mapping","conversion"]},s="Transformations - Data Transformation Utilities",l={},c=[{value:"Overview",id:"overview",level:2},{value:"NGSI-LD to Frontend",id:"ngsi-ld-to-frontend",level:2},{value:"Camera Transformation",id:"camera-transformation",level:3},{value:"Location Transformation",id:"location-transformation",level:3},{value:"Weather Transformation",id:"weather-transformation",level:3},{value:"Air Quality Transformation",id:"air-quality-transformation",level:3},{value:"To GeoJSON",id:"to-geojson",level:2},{value:"Batch Transformation",id:"batch-transformation",level:2},{value:"Related Documentation",id:"related-documentation",level:2},{value:"References",id:"references",level:2}];function d(n){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"transformations---data-transformation-utilities",children:"Transformations - Data Transformation Utilities"})}),"\n",(0,i.jsxs)(r.p,{children:["Data transformation utilities for converting between ",(0,i.jsx)(r.strong,{children:"NGSI-LD"}),", ",(0,i.jsx)(r.strong,{children:"GeoJSON"}),", and frontend-friendly formats."]}),"\n",(0,i.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-mermaid",children:"graph LR\r\n    A[NGSI-LD Entity] --\x3e B[Transformations]\r\n    B --\x3e C[Frontend Format]\r\n    B --\x3e D[GeoJSON]\r\n    B --\x3e E[Flat JSON]\n"})}),"\n",(0,i.jsx)(r.h2,{id:"ngsi-ld-to-frontend",children:"NGSI-LD to Frontend"}),"\n",(0,i.jsx)(r.h3,{id:"camera-transformation",children:"Camera Transformation"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"export function transformCamera(ngsiEntity: any): Camera {\r\n  return {\r\n    id: ngsiEntity.id,\r\n    name: extractValue(ngsiEntity, 'name') || 'Unknown Camera',\r\n    location: transformLocation(ngsiEntity.location),\r\n    imageUrl: extractValue(ngsiEntity, 'cameraImage') || \r\n              extractValue(ngsiEntity, 'image'),\r\n    status: extractValue(ngsiEntity, 'status') || 'unknown',\r\n    dateModified: ngsiEntity.dateModified || new Date().toISOString()\r\n  };\r\n}\r\n\r\nfunction extractValue(entity: any, propertyName: string): any {\r\n  const prop = entity[propertyName];\r\n  if (!prop) return undefined;\r\n  \r\n  // NGSI-LD Property format\r\n  if (prop.type === 'Property') {\r\n    return prop.value;\r\n  }\r\n  \r\n  // Simplified format\r\n  if (prop.value !== undefined) {\r\n    return prop.value;\r\n  }\r\n  \r\n  return prop;\r\n}\n"})}),"\n",(0,i.jsx)(r.h3,{id:"location-transformation",children:"Location Transformation"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"export function transformLocation(location: any): {\r\n  latitude: number;\r\n  longitude: number;\r\n} | null {\r\n  if (!location) return null;\r\n  \r\n  // GeoProperty format\r\n  if (location.type === 'GeoProperty' && location.value) {\r\n    const coords = location.value.coordinates;\r\n    return {\r\n      latitude: coords[1],\r\n      longitude: coords[0]\r\n    };\r\n  }\r\n  \r\n  // GeoJSON Point\r\n  if (location.type === 'Point') {\r\n    return {\r\n      latitude: location.coordinates[1],\r\n      longitude: location.coordinates[0]\r\n    };\r\n  }\r\n  \r\n  // Already transformed\r\n  if (location.latitude !== undefined && location.longitude !== undefined) {\r\n    return {\r\n      latitude: location.latitude,\r\n      longitude: location.longitude\r\n    };\r\n  }\r\n  \r\n  return null;\r\n}\n"})}),"\n",(0,i.jsx)(r.h3,{id:"weather-transformation",children:"Weather Transformation"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"export function transformWeather(ngsiEntity: any): Weather {\r\n  return {\r\n    id: ngsiEntity.id,\r\n    location: transformLocation(ngsiEntity.location),\r\n    temperature: extractValue(ngsiEntity, 'temperature'),\r\n    humidity: extractValue(ngsiEntity, 'relativeHumidity'),\r\n    precipitation: extractValue(ngsiEntity, 'precipitation'),\r\n    windSpeed: extractValue(ngsiEntity, 'windSpeed'),\r\n    windDirection: extractValue(ngsiEntity, 'windDirection'),\r\n    weatherType: extractValue(ngsiEntity, 'weatherType'),\r\n    observedAt: extractValue(ngsiEntity, 'dateObserved') || \r\n                ngsiEntity.dateModified\r\n  };\r\n}\n"})}),"\n",(0,i.jsx)(r.h3,{id:"air-quality-transformation",children:"Air Quality Transformation"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"export function transformAirQuality(ngsiEntity: any): AirQuality {\r\n  const aqi = extractValue(ngsiEntity, 'airQualityIndex') ||\r\n              extractValue(ngsiEntity, 'aqi');\r\n  \r\n  return {\r\n    id: ngsiEntity.id,\r\n    location: transformLocation(ngsiEntity.location),\r\n    aqi: aqi,\r\n    category: getAqiCategory(aqi),\r\n    pm25: extractValue(ngsiEntity, 'PM25') || \r\n          extractValue(ngsiEntity, 'pm2_5'),\r\n    pm10: extractValue(ngsiEntity, 'PM10'),\r\n    o3: extractValue(ngsiEntity, 'O3'),\r\n    no2: extractValue(ngsiEntity, 'NO2'),\r\n    co: extractValue(ngsiEntity, 'CO'),\r\n    so2: extractValue(ngsiEntity, 'SO2'),\r\n    observedAt: extractValue(ngsiEntity, 'dateObserved')\r\n  };\r\n}\r\n\r\nfunction getAqiCategory(aqi: number): string {\r\n  if (aqi <= 50) return 'Good';\r\n  if (aqi <= 100) return 'Moderate';\r\n  if (aqi <= 150) return 'Unhealthy for Sensitive Groups';\r\n  if (aqi <= 200) return 'Unhealthy';\r\n  if (aqi <= 300) return 'Very Unhealthy';\r\n  return 'Hazardous';\r\n}\n"})}),"\n",(0,i.jsx)(r.h2,{id:"to-geojson",children:"To GeoJSON"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"export function toGeoJSON(entities: any[]): GeoJSON.FeatureCollection {\r\n  return {\r\n    type: 'FeatureCollection',\r\n    features: entities.map(entity => ({\r\n      type: 'Feature',\r\n      id: entity.id,\r\n      geometry: {\r\n        type: 'Point',\r\n        coordinates: [\r\n          entity.location.longitude,\r\n          entity.location.latitude\r\n        ]\r\n      },\r\n      properties: {\r\n        name: entity.name,\r\n        status: entity.status,\r\n        ...entity\r\n      }\r\n    }))\r\n  };\r\n}\n"})}),"\n",(0,i.jsx)(r.h2,{id:"batch-transformation",children:"Batch Transformation"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"export function transformBatch<T>(\r\n  entities: any[],\r\n  transformer: (entity: any) => T\r\n): T[] {\r\n  return entities\r\n    .map(entity => {\r\n      try {\r\n        return transformer(entity);\r\n      } catch (error) {\r\n        logger.warn(`Transform failed for ${entity.id}:`, error);\r\n        return null;\r\n      }\r\n    })\r\n    .filter((item): item is T => item !== null);\r\n}\r\n\r\n// Usage\r\nconst cameras = transformBatch(ngsiEntities, transformCamera);\n"})}),"\n",(0,i.jsx)(r.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/tes/docs/backend/services/generic-ngsi-service",children:"GenericNgsiService"})," - Config-driven transforms"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/tes/docs/backend/services/stellio-service",children:"StellioService"})," - NGSI-LD source"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/tes/docs/backend/routes/routes-overview",children:"Routes"})," - Uses transformations"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"references",children:"References"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://www.etsi.org/deliver/etsi_gs/CIM/001_099/009/01.06.01_60/gs_cim009v010601p.pdf",children:"NGSI-LD Specification"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://datatracker.ietf.org/doc/html/rfc7946",children:"GeoJSON Specification"})}),"\n"]})]})}function u(n={}){const{wrapper:r}={...(0,a.R)(),...n.components};return r?(0,i.jsx)(r,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},8453:(n,r,t)=>{t.d(r,{R:()=>o,x:()=>s});var e=t(6540);const i={},a=e.createContext(i);function o(n){const r=e.useContext(a);return e.useMemo(function(){return"function"==typeof n?n(r):{...r,...n}},[r,n])}function s(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:o(n.components),e.createElement(a.Provider,{value:r},n.children)}}}]);