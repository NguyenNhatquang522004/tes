"use strict";(globalThis.webpackChunkuip_urban_intelligence_platform_docs=globalThis.webpackChunkuip_urban_intelligence_platform_docs||[]).push([[6381],{1240:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"agents/analytics/cv-analysis","title":"cv-analysis","description":"\x3c!--","source":"@site/docs/agents/analytics/cv-analysis.md","sourceDirName":"agents/analytics","slug":"/agents/analytics/cv-analysis","permalink":"/tes/docs/agents/analytics/cv-analysis","draft":false,"unlisted":false,"editUrl":"https://github.com/NguyenNhatquang522004/UIP-Urban_Intelligence_Platform/tree/main/apps/traffic-web-app/frontend/docs/docs/agents/analytics/cv-analysis.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"congestion-detection","permalink":"/tes/docs/agents/analytics/congestion-detection"},"next":{"title":"pattern-recognition","permalink":"/tes/docs/agents/analytics/pattern-recognition"}}');var t=i(4848),s=i(8453);const c={},l="Computer Vision Analysis Agent",r={},d=[{value:"Overview",id:"overview",level:2},{value:"Features",id:"features",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Usage",id:"usage",level:2},{value:"Basic Vehicle Detection",id:"basic-vehicle-detection",level:3},{value:"Real-time Video Stream Analysis",id:"real-time-video-stream-analysis",level:3},{value:"Speed Estimation",id:"speed-estimation",level:3},{value:"Lane Occupancy Analysis",id:"lane-occupancy-analysis",level:3},{value:"Traffic Flow Metrics",id:"traffic-flow-metrics",level:3},{value:"API Reference",id:"api-reference",level:2},{value:"Class: <code>CVAnalysisAgent</code>",id:"class-cvanalysisagent",level:3},{value:"Methods",id:"methods",level:4},{value:"<code>analyze_frame(camera_id: str, frame: np.ndarray) -&gt; AnalysisResult</code>",id:"analyze_framecamera_id-str-frame-npndarray---analysisresult",level:5},{value:"<code>get_vehicle_speeds(camera_id: str, time_window: int) -&gt; List[VehicleSpeed]</code>",id:"get_vehicle_speedscamera_id-str-time_window-int---listvehiclespeed",level:5},{value:"<code>analyze_lane_occupancy(camera_id: str) -&gt; List[LaneStats]</code>",id:"analyze_lane_occupancycamera_id-str---listlanestats",level:5},{value:"<code>calculate_flow_metrics(camera_id: str, time_window: int) -&gt; FlowMetrics</code>",id:"calculate_flow_metricscamera_id-str-time_window-int---flowmetrics",level:5},{value:"<code>calibrate_camera(camera_id: str, reference_distance: float, pixel_distance: float)</code>",id:"calibrate_cameracamera_id-str-reference_distance-float-pixel_distance-float",level:5},{value:"Data Models",id:"data-models",level:3},{value:"<code>AnalysisResult</code>",id:"analysisresult",level:4},{value:"<code>Detection</code>",id:"detection",level:4},{value:"<code>VehicleSpeed</code>",id:"vehiclespeed",level:4},{value:"<code>LaneStats</code>",id:"lanestats",level:4},{value:"<code>FlowMetrics</code>",id:"flowmetrics",level:4},{value:"Vehicle Classification",id:"vehicle-classification",level:2},{value:"Supported Classes",id:"supported-classes",level:3},{value:"Speed Estimation Methods",id:"speed-estimation-methods",level:2},{value:"1. Optical Flow",id:"1-optical-flow",level:3},{value:"2. Calibrated Tracking",id:"2-calibrated-tracking",level:3},{value:"Integration Examples",id:"integration-examples",level:2},{value:"Integration with Congestion Detection",id:"integration-with-congestion-detection",level:3},{value:"Integration with Pattern Recognition",id:"integration-with-pattern-recognition",level:3},{value:"Integration with Accident Detection",id:"integration-with-accident-detection",level:3},{value:"Monitoring &amp; Metrics",id:"monitoring--metrics",level:2},{value:"Health Check",id:"health-check",level:3},{value:"Performance Metrics",id:"performance-metrics",level:3},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"GPU Acceleration",id:"gpu-acceleration",level:3},{value:"Frame Skipping",id:"frame-skipping",level:3},{value:"Region of Interest",id:"region-of-interest",level:3},{value:"Testing",id:"testing",level:2},{value:"Unit Tests",id:"unit-tests",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Camera Calibration",id:"1-camera-calibration",level:3},{value:"2. Adaptive Processing",id:"2-adaptive-processing",level:3},{value:"3. Model Ensemble",id:"3-model-ensemble",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Issue: Low Detection Accuracy",id:"issue-low-detection-accuracy",level:3},{value:"Issue: Inaccurate Speed Estimation",id:"issue-inaccurate-speed-estimation",level:3},{value:"Issue: High GPU Memory Usage",id:"issue-high-gpu-memory-usage",level:3},{value:"Related Documentation",id:"related-documentation",level:2},{value:"License",id:"license",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"computer-vision-analysis-agent",children:"Computer Vision Analysis Agent"})}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"The Computer Vision Analysis Agent provides comprehensive video analytics capabilities, including vehicle counting, classification, speed estimation, lane monitoring, and behavior analysis using state-of-the-art deep learning models."}),"\n",(0,t.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Vehicle Detection & Counting"}),": Real-time vehicle detection and counting across multiple lanes"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Vehicle Classification"}),": 8-class classification (car, truck, bus, motorcycle, bicycle, etc.)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Speed Estimation"}),": Calculate vehicle speeds using optical flow and calibration"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Lane Occupancy"}),": Monitor lane-level traffic distribution"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Traffic Flow Metrics"}),": Calculate flow rate, density, and occupancy"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Behavior Analysis"}),": Detect lane violations, wrong-way driving, illegal parking"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mermaid",children:"graph TB\n    A[Video Stream] --\x3e B[Frame Extractor]\n    B --\x3e C[YOLOX Detector]\n    C --\x3e D[Vehicle Tracker]\n    D --\x3e E[Classification]\n    D --\x3e F[Speed Estimator]\n    D --\x3e G[Lane Analyzer]\n    E --\x3e H[Counter]\n    F --\x3e I[Flow Calculator]\n    G --\x3e J[Occupancy Monitor]\n    H --\x3e K[Metrics Aggregator]\n    I --\x3e K\n    J --\x3e K\n    K --\x3e L[MongoDB Storage]\n    K --\x3e M[Real-time Dashboard]\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"File"}),": ",(0,t.jsx)(n.code,{children:"config/cv_config.yaml"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'cv_analysis:\n  detection:\n    model: "yolox_x"\n    weights: "yolox_x.pth"\n    confidence_threshold: 0.5\n    iou_threshold: 0.45\n    device: "cuda"\n    \n  vehicle_classes:\n    - id: 0\n      name: "car"\n      size_category: "small"\n      \n    - id: 1\n      name: "truck"\n      size_category: "large"\n      \n    - id: 2\n      name: "bus"\n      size_category: "large"\n      \n    - id: 3\n      name: "motorcycle"\n      size_category: "small"\n      \n    - id: 4\n      name: "bicycle"\n      size_category: "small"\n      \n  tracking:\n    method: "strongsort"\n    max_age: 30           # frames\n    min_hits: 3\n    iou_threshold: 0.3\n    \n  speed_estimation:\n    enabled: true\n    calibration_required: true\n    units: "km/h"\n    smoothing_window: 5   # frames\n    \n  lane_detection:\n    enabled: true\n    num_lanes: 4\n    lane_width: 3.5       # meters\n    \n  metrics:\n    calculation_interval: 60    # seconds\n    aggregation_window: 300     # 5 minutes\n    \n  performance:\n    target_fps: 15\n    skip_frames: 2\n    batch_size: 1\n'})}),"\n",(0,t.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,t.jsx)(n.h3,{id:"basic-vehicle-detection",children:"Basic Vehicle Detection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from src.agents.analytics.cv_analysis_agent import CVAnalysisAgent\n\n# Initialize agent\nagent = CVAnalysisAgent()\n\n# Analyze single frame\nresult = agent.analyze_frame(\n    camera_id="CAM_001",\n    frame=cv2.imread("traffic_frame.jpg")\n)\n\nprint(f"Vehicles detected: {result.vehicle_count}")\nprint(f"Cars: {result.class_counts[\'car\']}")\nprint(f"Trucks: {result.class_counts[\'truck\']}")\nprint(f"Motorcycles: {result.class_counts[\'motorcycle\']}")\n'})}),"\n",(0,t.jsx)(n.h3,{id:"real-time-video-stream-analysis",children:"Real-time Video Stream Analysis"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# Process video stream\ndef analyze_stream(camera_id):\n    agent = CVAnalysisAgent()\n    \n    for frame in video_stream(camera_id):\n        analysis = agent.analyze_frame(\n            camera_id=camera_id,\n            frame=frame\n        )\n        \n        # Display results\n        print(f"Frame {analysis.frame_number}:")\n        print(f"  Vehicles: {analysis.vehicle_count}")\n        print(f"  Avg Speed: {analysis.avg_speed} km/h")\n        print(f"  Flow Rate: {analysis.flow_rate} veh/h")\n'})}),"\n",(0,t.jsx)(n.h3,{id:"speed-estimation",children:"Speed Estimation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# Calibrate camera for speed estimation\nagent.calibrate_camera(\n    camera_id="CAM_001",\n    reference_distance=50,  # meters\n    pixel_distance=500      # pixels\n)\n\n# Get vehicle speeds\nspeeds = agent.get_vehicle_speeds(\n    camera_id="CAM_001",\n    time_window=60  # seconds\n)\n\nfor vehicle in speeds:\n    print(f"Vehicle {vehicle.id}: {vehicle.speed} km/h")\n    if vehicle.speed > 60:  # Speed limit\n        print(f"  \u26a0\ufe0f Speeding detected!")\n'})}),"\n",(0,t.jsx)(n.h3,{id:"lane-occupancy-analysis",children:"Lane Occupancy Analysis"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# Analyze lane-level traffic\nlane_stats = agent.analyze_lane_occupancy(\n    camera_id="CAM_001"\n)\n\nfor lane in lane_stats:\n    print(f"Lane {lane.number}:")\n    print(f"  Occupancy: {lane.occupancy_pct}%")\n    print(f"  Vehicle Count: {lane.vehicle_count}")\n    print(f"  Average Speed: {lane.avg_speed} km/h")\n    print(f"  Flow Rate: {lane.flow_rate} veh/h")\n'})}),"\n",(0,t.jsx)(n.h3,{id:"traffic-flow-metrics",children:"Traffic Flow Metrics"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# Calculate comprehensive flow metrics\nmetrics = agent.calculate_flow_metrics(\n    camera_id="CAM_001",\n    time_window=300  # 5 minutes\n)\n\nprint(f"Flow Rate: {metrics.flow_rate} vehicles/hour")\nprint(f"Density: {metrics.density} vehicles/km")\nprint(f"Average Speed: {metrics.avg_speed} km/h")\nprint(f"Level of Service: {metrics.los}")  # A, B, C, D, E, F\n'})}),"\n",(0,t.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,t.jsxs)(n.h3,{id:"class-cvanalysisagent",children:["Class: ",(0,t.jsx)(n.code,{children:"CVAnalysisAgent"})]}),"\n",(0,t.jsx)(n.h4,{id:"methods",children:"Methods"}),"\n",(0,t.jsx)(n.h5,{id:"analyze_framecamera_id-str-frame-npndarray---analysisresult",children:(0,t.jsx)(n.code,{children:"analyze_frame(camera_id: str, frame: np.ndarray) -> AnalysisResult"})}),"\n",(0,t.jsx)(n.p,{children:"Analyze a single video frame."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"camera_id"})," (str): Camera identifier"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"frame"})," (np.ndarray): Video frame (BGR format)"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Returns:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"AnalysisResult: Comprehensive analysis results"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'result = agent.analyze_frame("CAM_001", frame)\nprint(f"Detected: {result.vehicle_count} vehicles")\n'})}),"\n",(0,t.jsx)(n.h5,{id:"get_vehicle_speedscamera_id-str-time_window-int---listvehiclespeed",children:(0,t.jsx)(n.code,{children:"get_vehicle_speeds(camera_id: str, time_window: int) -> List[VehicleSpeed]"})}),"\n",(0,t.jsx)(n.p,{children:"Get vehicle speeds over time window."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"camera_id"})," (str): Camera identifier"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"time_window"})," (int): Time window in seconds"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Returns:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"List[VehicleSpeed]: Vehicle speed data"}),"\n"]}),"\n",(0,t.jsx)(n.h5,{id:"analyze_lane_occupancycamera_id-str---listlanestats",children:(0,t.jsx)(n.code,{children:"analyze_lane_occupancy(camera_id: str) -> List[LaneStats]"})}),"\n",(0,t.jsx)(n.p,{children:"Analyze lane-level traffic statistics."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"camera_id"})," (str): Camera identifier"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Returns:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"List[LaneStats]: Lane statistics"}),"\n"]}),"\n",(0,t.jsx)(n.h5,{id:"calculate_flow_metricscamera_id-str-time_window-int---flowmetrics",children:(0,t.jsx)(n.code,{children:"calculate_flow_metrics(camera_id: str, time_window: int) -> FlowMetrics"})}),"\n",(0,t.jsx)(n.p,{children:"Calculate traffic flow metrics."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"camera_id"})," (str): Camera identifier"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"time_window"})," (int): Calculation window (seconds)"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Returns:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"FlowMetrics: Flow metrics"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'metrics = agent.calculate_flow_metrics("CAM_001", 300)\nprint(f"Flow: {metrics.flow_rate} veh/h")\n'})}),"\n",(0,t.jsx)(n.h5,{id:"calibrate_cameracamera_id-str-reference_distance-float-pixel_distance-float",children:(0,t.jsx)(n.code,{children:"calibrate_camera(camera_id: str, reference_distance: float, pixel_distance: float)"})}),"\n",(0,t.jsx)(n.p,{children:"Calibrate camera for accurate measurements."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"camera_id"})," (str): Camera identifier"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"reference_distance"})," (float): Real-world distance (meters)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"pixel_distance"})," (float): Corresponding pixel distance"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'agent.calibrate_camera("CAM_001", 50, 500)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"data-models",children:"Data Models"}),"\n",(0,t.jsx)(n.h4,{id:"analysisresult",children:(0,t.jsx)(n.code,{children:"AnalysisResult"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"@dataclass\nclass AnalysisResult:\n    timestamp: datetime\n    camera_id: str\n    frame_number: int\n    vehicle_count: int\n    class_counts: dict             # {class_name: count}\n    detections: List[Detection]\n    avg_speed: float               # km/h\n    flow_rate: int                 # vehicles/hour\n    lane_occupancy: List[float]    # per-lane occupancy %\n    metadata: dict\n"})}),"\n",(0,t.jsx)(n.h4,{id:"detection",children:(0,t.jsx)(n.code,{children:"Detection"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"@dataclass\nclass Detection:\n    id: int\n    class_name: str\n    confidence: float\n    bbox: dict                     # {x, y, width, height}\n    speed: float                   # km/h (if estimated)\n    lane: int\n    trajectory: List[dict]         # Historical positions\n    first_seen: datetime\n    last_seen: datetime\n"})}),"\n",(0,t.jsx)(n.h4,{id:"vehiclespeed",children:(0,t.jsx)(n.code,{children:"VehicleSpeed"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"@dataclass\nclass VehicleSpeed:\n    vehicle_id: int\n    class_name: str\n    speed: float                   # km/h\n    timestamp: datetime\n    lane: int\n    position: dict\n    is_speeding: bool\n"})}),"\n",(0,t.jsx)(n.h4,{id:"lanestats",children:(0,t.jsx)(n.code,{children:"LaneStats"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"@dataclass\nclass LaneStats:\n    lane_number: int\n    occupancy_pct: float           # 0-100\n    vehicle_count: int\n    avg_speed: float               # km/h\n    flow_rate: int                 # vehicles/hour\n    density: float                 # vehicles/km\n    dominant_class: str\n"})}),"\n",(0,t.jsx)(n.h4,{id:"flowmetrics",children:(0,t.jsx)(n.code,{children:"FlowMetrics"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"@dataclass\nclass FlowMetrics:\n    flow_rate: int                 # vehicles/hour\n    density: float                 # vehicles/km\n    avg_speed: float               # km/h\n    avg_headway: float             # seconds\n    avg_spacing: float             # meters\n    level_of_service: str          # A, B, C, D, E, F\n    capacity_utilization: float    # 0-1\n"})}),"\n",(0,t.jsx)(n.h2,{id:"vehicle-classification",children:"Vehicle Classification"}),"\n",(0,t.jsx)(n.h3,{id:"supported-classes",children:"Supported Classes"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Class ID"}),(0,t.jsx)(n.th,{children:"Name"}),(0,t.jsx)(n.th,{children:"Size Category"}),(0,t.jsx)(n.th,{children:"Typical Count"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"0"}),(0,t.jsx)(n.td,{children:"Car"}),(0,t.jsx)(n.td,{children:"Small"}),(0,t.jsx)(n.td,{children:"~60%"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:"Truck"}),(0,t.jsx)(n.td,{children:"Large"}),(0,t.jsx)(n.td,{children:"~10%"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"2"}),(0,t.jsx)(n.td,{children:"Bus"}),(0,t.jsx)(n.td,{children:"Large"}),(0,t.jsx)(n.td,{children:"~5%"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"3"}),(0,t.jsx)(n.td,{children:"Motorcycle"}),(0,t.jsx)(n.td,{children:"Small"}),(0,t.jsx)(n.td,{children:"~20%"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"4"}),(0,t.jsx)(n.td,{children:"Bicycle"}),(0,t.jsx)(n.td,{children:"Small"}),(0,t.jsx)(n.td,{children:"~3%"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"5"}),(0,t.jsx)(n.td,{children:"Pedestrian"}),(0,t.jsx)(n.td,{children:"N/A"}),(0,t.jsx)(n.td,{children:"~2%"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"6"}),(0,t.jsx)(n.td,{children:"Van"}),(0,t.jsx)(n.td,{children:"Medium"}),(0,t.jsx)(n.td,{children:"~5%"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"7"}),(0,t.jsx)(n.td,{children:"Emergency"}),(0,t.jsx)(n.td,{children:"Special"}),(0,t.jsx)(n.td,{children:"<1%"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"speed-estimation-methods",children:"Speed Estimation Methods"}),"\n",(0,t.jsx)(n.h3,{id:"1-optical-flow",children:"1. Optical Flow"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# Enable optical flow-based speed estimation\nagent.configure_speed_estimation(\n    method="optical_flow",\n    calibration_required=False\n)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"2-calibrated-tracking",children:"2. Calibrated Tracking"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# More accurate with calibration\nagent.calibrate_camera("CAM_001", reference_distance=50, pixel_distance=500)\nagent.configure_speed_estimation(\n    method="calibrated_tracking",\n    smoothing_window=5\n)\n'})}),"\n",(0,t.jsx)(n.h2,{id:"integration-examples",children:"Integration Examples"}),"\n",(0,t.jsx)(n.h3,{id:"integration-with-congestion-detection",children:"Integration with Congestion Detection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"from src.agents.analytics.congestion_detection_agent import CongestionDetectionAgent\n\ncv_agent = CVAnalysisAgent()\ncongestion_agent = CongestionDetectionAgent()\n\n# Use CV metrics for congestion detection\ndef detect_congestion(camera_id):\n    # Get flow metrics from CV\n    metrics = cv_agent.calculate_flow_metrics(camera_id, 300)\n    \n    # Update congestion detection\n    congestion_agent.update_metrics(\n        zone_id=camera_to_zone[camera_id],\n        speed=metrics.avg_speed,\n        density=metrics.density,\n        flow=metrics.flow_rate\n    )\n"})}),"\n",(0,t.jsx)(n.h3,{id:"integration-with-pattern-recognition",children:"Integration with Pattern Recognition"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from src.agents.analytics.pattern_recognition_agent import PatternRecognitionAgent\n\npattern_agent = PatternRecognitionAgent()\n\n# Analyze vehicle composition patterns\ncomposition_patterns = pattern_agent.detect_patterns(\n    metric="vehicle_composition",\n    data_source=cv_agent.get_historical_composition("30d")\n)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"integration-with-accident-detection",children:"Integration with Accident Detection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from src.agents.analytics.accident_detection_agent import AccidentDetectionAgent\n\naccident_agent = AccidentDetectionAgent()\n\n# Use CV tracking for accident context\ndef analyze_accident_context(camera_id):\n    # Get vehicles near accident\n    analysis = cv_agent.analyze_frame(camera_id, frame)\n    \n    # Estimate severity based on vehicle count\n    involved_vehicles = len([\n        v for v in analysis.detections\n        if v.speed < 5  # Stopped vehicles\n    ])\n    \n    return {\n        "involved_vehicles": involved_vehicles,\n        "traffic_density": analysis.vehicle_count,\n        "lane_blockage": cv_agent.calculate_blockage(analysis)\n    }\n'})}),"\n",(0,t.jsx)(n.h2,{id:"monitoring--metrics",children:"Monitoring & Metrics"}),"\n",(0,t.jsx)(n.h3,{id:"health-check",children:"Health Check"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'health = agent.health_check()\nprint(f"Status: {health.status}")\nprint(f"Model Loaded: {health.model_loaded}")\nprint(f"Active Cameras: {health.active_cameras}")\nprint(f"Processing FPS: {health.avg_fps}")\nprint(f"GPU Utilization: {health.gpu_usage}%")\n'})}),"\n",(0,t.jsx)(n.h3,{id:"performance-metrics",children:"Performance Metrics"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'metrics = agent.get_performance_metrics()\n\nprint(f"Detection Latency: {metrics.avg_latency}ms")\nprint(f"Tracking Accuracy: {metrics.tracking_accuracy}%")\nprint(f"Speed Estimation Error: {metrics.speed_error_pct}%")\n'})}),"\n",(0,t.jsx)(n.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,t.jsx)(n.h3,{id:"gpu-acceleration",children:"GPU Acceleration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# Configure GPU settings\nagent.configure_device(\n    device="cuda",\n    precision="fp16",\n    batch_size=4\n)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"frame-skipping",children:"Frame Skipping"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"# Process every Nth frame\nagent.configure_processing(\n    skip_frames=2,      # Process every 3rd frame\n    target_fps=10\n)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"region-of-interest",children:"Region of Interest"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# Only process specific region\nagent.set_roi(\n    camera_id="CAM_001",\n    roi=[[100, 100], [500, 400]]  # [x, y] coordinates\n)\n'})}),"\n",(0,t.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,t.jsx)(n.h3,{id:"unit-tests",children:"Unit Tests"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import pytest\n\ndef test_vehicle_detection():\n    agent = CVAnalysisAgent()\n    \n    # Test with known image\n    frame = cv2.imread("test_data/traffic_5_vehicles.jpg")\n    result = agent.analyze_frame("CAM_TEST", frame)\n    \n    assert result.vehicle_count >= 4  # Allow \xb11 tolerance\n    assert len(result.detections) > 0\n\ndef test_speed_estimation():\n    agent = CVAnalysisAgent()\n    agent.calibrate_camera("CAM_TEST", 50, 500)\n    \n    # Test with moving vehicle sequence\n    speeds = []\n    for frame in test_frames:\n        result = agent.analyze_frame("CAM_TEST", frame)\n        if result.detections:\n            speeds.append(result.detections[0].speed)\n    \n    assert len(speeds) > 0\n    assert all(s >= 0 for s in speeds)\n'})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(n.h3,{id:"1-camera-calibration",children:"1. Camera Calibration"}),"\n",(0,t.jsx)(n.p,{children:"Always calibrate cameras for accurate measurements:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'agent.calibrate_all_cameras(\n    calibration_data="config/camera_calibrations.yaml"\n)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"2-adaptive-processing",children:"2. Adaptive Processing"}),"\n",(0,t.jsx)(n.p,{children:"Adjust processing based on traffic density:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"agent.enable_adaptive_processing(\n    low_traffic_fps=5,\n    high_traffic_fps=15\n)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-model-ensemble",children:"3. Model Ensemble"}),"\n",(0,t.jsx)(n.p,{children:"Use multiple models for better accuracy:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'agent.enable_model_ensemble(\n    models=["yolox_x", "yolox_l"],\n    voting_method="confidence"\n)\n'})}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"issue-low-detection-accuracy",children:"Issue: Low Detection Accuracy"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),": Adjust confidence threshold and retrain on local data"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'agent.configure_model(confidence_threshold=0.4)\nagent.fine_tune(training_images="local_traffic_data/")\n'})}),"\n",(0,t.jsx)(n.h3,{id:"issue-inaccurate-speed-estimation",children:"Issue: Inaccurate Speed Estimation"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),": Recalibrate camera and increase smoothing"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'agent.calibrate_camera("CAM_001", reference_distance=50, pixel_distance=500)\nagent.configure_speed_estimation(smoothing_window=10)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"issue-high-gpu-memory-usage",children:"Issue: High GPU Memory Usage"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),": Reduce batch size and use FP16 precision"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'agent.configure_device(batch_size=1, precision="fp16")\n'})}),"\n",(0,t.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/tes/docs/agents/analytics/accident-detection",children:"Accident Detection Agent"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/tes/docs/agents/analytics/congestion-detection",children:"Congestion Detection Agent"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/tes/docs/agents/data-collection/camera-image-fetch",children:"Camera Image Fetch Agent"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"license",children:"License"}),"\n",(0,t.jsx)(n.p,{children:"MIT License - Copyright (c) 2025 UIP Contributors (Nguy\u1ec5n Nh\u1eadt Quang, Nguy\u1ec5n Vi\u1ec7t Ho\xe0ng, Nguy\u1ec5n \u0110\xecnh Anh Tu\u1ea5n)"}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.a,{href:"../LICENSE",children:"LICENSE"})," for details."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>l});var a=i(6540);const t={},s=a.createContext(t);function c(e){const n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);