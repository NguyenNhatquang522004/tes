"use strict";(globalThis.webpackChunkuip_urban_intelligence_platform_docs=globalThis.webpackChunkuip_urban_intelligence_platform_docs||[]).push([[4976],{6648:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>g,frontMatter:()=>i,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"backend/utils/logger","title":"Logger - Winston Logging System","description":"Winston-based logging system with console and file transports, structured JSON output, and log rotation for production environments.","source":"@site/docs/backend/utils/logger.md","sourceDirName":"backend/utils","slug":"/backend/utils/logger","permalink":"/tes/docs/backend/utils/logger","draft":false,"unlisted":false,"editUrl":"https://github.com/NguyenNhatquang522004/UIP-Urban_Intelligence_Platform/tree/main/apps/traffic-web-app/frontend/docs/docs/backend/utils/logger.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"id":"logger","title":"Logger - Winston Logging System","sidebar_label":"Logger","sidebar_position":1,"description":"Winston-based logging system with console and file transports, structured JSON output, and log rotation for production environments.","keywords":["logger","winston","logging","structured","file-rotation","debug"]}}');var o=r(4848),s=r(8453);const i={id:"logger",title:"Logger - Winston Logging System",sidebar_label:"Logger",sidebar_position:1,description:"Winston-based logging system with console and file transports, structured JSON output, and log rotation for production environments.",keywords:["logger","winston","logging","structured","file-rotation","debug"]},l="Logger - Winston Logging System",d={},a=[{value:"Overview",id:"overview",level:2},{value:"Features",id:"features",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Log Levels",id:"log-levels",level:2},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Basic Logging",id:"basic-logging",level:3},{value:"Request Logging",id:"request-logging",level:3},{value:"Agent Logging",id:"agent-logging",level:3},{value:"Log Output Examples",id:"log-output-examples",level:2},{value:"Console Output (Development)",id:"console-output-development",level:3},{value:"JSON Output (Production)",id:"json-output-production",level:3},{value:"Error Log",id:"error-log",level:3},{value:"Environment Configuration",id:"environment-configuration",level:2},{value:"Log File Rotation",id:"log-file-rotation",level:2},{value:"Related Documentation",id:"related-documentation",level:2},{value:"References",id:"references",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"logger---winston-logging-system",children:"Logger - Winston Logging System"})}),"\n",(0,o.jsx)(n.p,{children:"Winston-based logging system with console and file transports, structured JSON output, and log rotation for production environments."}),"\n",(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-mermaid",children:'graph TB\r\n    subgraph Application\r\n        SRC[Source Code]\r\n    end\r\n    \r\n    subgraph Logger["Winston Logger"]\r\n        FORMAT[Format Pipeline]\r\n        CONSOLE[Console Transport]\r\n        FILE[File Transport]\r\n        ERROR[Error File]\r\n    end\r\n    \r\n    subgraph Output\r\n        STDOUT[stdout/stderr]\r\n        LOGS[logs/combined.log]\r\n        ERRLOGS[logs/error.log]\r\n    end\r\n    \r\n    SRC --\x3e FORMAT\r\n    FORMAT --\x3e CONSOLE\r\n    FORMAT --\x3e FILE\r\n    FORMAT --\x3e ERROR\r\n    CONSOLE --\x3e STDOUT\r\n    FILE --\x3e LOGS\r\n    ERROR --\x3e ERRLOGS\n'})}),"\n",(0,o.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Feature"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Structured Logging"})}),(0,o.jsx)(n.td,{children:"JSON format with metadata"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Console Output"})}),(0,o.jsx)(n.td,{children:"Colorized human-readable output"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"File Rotation"})}),(0,o.jsx)(n.td,{children:"Daily rotation, 14-day retention"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Error Isolation"})}),(0,o.jsx)(n.td,{children:"Separate error log file"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Request Logging"})}),(0,o.jsx)(n.td,{children:"HTTP request/response logging"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Performance"})}),(0,o.jsx)(n.td,{children:"Async I/O, buffered writes"})]})]})]}),"\n",(0,o.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"// utils/logger.ts\r\nimport winston from 'winston';\r\n\r\nconst logger = winston.createLogger({\r\n  level: process.env.LOG_LEVEL || 'info',\r\n  format: winston.format.combine(\r\n    winston.format.timestamp(),\r\n    winston.format.errors({ stack: true }),\r\n    winston.format.json()\r\n  ),\r\n  defaultMeta: { service: 'uip-traffic-backend' },\r\n  transports: [\r\n    // Console transport (development)\r\n    new winston.transports.Console({\r\n      format: winston.format.combine(\r\n        winston.format.colorize(),\r\n        winston.format.simple()\r\n      )\r\n    }),\r\n    // Combined log file\r\n    new winston.transports.File({\r\n      filename: 'logs/combined.log',\r\n      maxsize: 5242880,  // 5MB\r\n      maxFiles: 14\r\n    }),\r\n    // Error log file\r\n    new winston.transports.File({\r\n      filename: 'logs/error.log',\r\n      level: 'error'\r\n    })\r\n  ]\r\n});\r\n\r\nexport { logger };\n"})}),"\n",(0,o.jsx)(n.h2,{id:"log-levels",children:"Log Levels"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Level"}),(0,o.jsx)(n.th,{children:"Priority"}),(0,o.jsx)(n.th,{children:"Description"}),(0,o.jsx)(n.th,{children:"Usage"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"error"})}),(0,o.jsx)(n.td,{children:"0"}),(0,o.jsx)(n.td,{children:"Error conditions"}),(0,o.jsx)(n.td,{children:"Exceptions, failures"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"warn"})}),(0,o.jsx)(n.td,{children:"1"}),(0,o.jsx)(n.td,{children:"Warning conditions"}),(0,o.jsx)(n.td,{children:"Deprecations, retries"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"info"})}),(0,o.jsx)(n.td,{children:"2"}),(0,o.jsx)(n.td,{children:"Informational"}),(0,o.jsx)(n.td,{children:"Service status, events"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"http"})}),(0,o.jsx)(n.td,{children:"3"}),(0,o.jsx)(n.td,{children:"HTTP requests"}),(0,o.jsx)(n.td,{children:"Request/response logs"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"verbose"})}),(0,o.jsx)(n.td,{children:"4"}),(0,o.jsx)(n.td,{children:"Verbose info"}),(0,o.jsx)(n.td,{children:"Detailed operations"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"debug"})}),(0,o.jsx)(n.td,{children:"5"}),(0,o.jsx)(n.td,{children:"Debug information"}),(0,o.jsx)(n.td,{children:"Development debugging"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"silly"})}),(0,o.jsx)(n.td,{children:"6"}),(0,o.jsx)(n.td,{children:"All messages"}),(0,o.jsx)(n.td,{children:"Everything"})]})]})]}),"\n",(0,o.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,o.jsx)(n.h3,{id:"basic-logging",children:"Basic Logging"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { logger } from '../utils/logger';\r\n\r\n// Simple messages\r\nlogger.info('Server started on port 5000');\r\nlogger.warn('Cache miss for entity');\r\nlogger.error('Database connection failed');\r\nlogger.debug('Processing entity batch');\r\n\r\n// With metadata\r\nlogger.info('Camera fetched', {\r\n  cameraId: 'urn:ngsi-ld:Camera:001',\r\n  responseTime: 125\r\n});\r\n\r\n// Error with stack trace\r\ntry {\r\n  throw new Error('Connection refused');\r\n} catch (error) {\r\n  logger.error('Failed to connect', { error });\r\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"request-logging",children:"Request Logging"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"// Middleware for request logging\r\napp.use((req, res, next) => {\r\n  const start = Date.now();\r\n  \r\n  res.on('finish', () => {\r\n    logger.http({\r\n      method: req.method,\r\n      url: req.originalUrl,\r\n      status: res.statusCode,\r\n      duration: Date.now() - start,\r\n      userAgent: req.get('User-Agent')\r\n    });\r\n  });\r\n  \r\n  next();\r\n});\n"})}),"\n",(0,o.jsx)(n.h3,{id:"agent-logging",children:"Agent Logging"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"// In EcoTwinAgent\r\nlogger.info('EcoTwin processing request', {\r\n  location: { lat: 10.77, lng: 106.70 },\r\n  userProfile: profile.id\r\n});\r\n\r\nlogger.debug('Gemini API response', {\r\n  tokens: response.usageMetadata?.totalTokenCount\r\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"log-output-examples",children:"Log Output Examples"}),"\n",(0,o.jsx)(n.h3,{id:"console-output-development",children:"Console Output (Development)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"info: Server started on port 5000\r\ninfo: \u2705 Connected to Stellio Context Broker\r\nwarn: \u26a0\ufe0f Cache miss for Camera:001\r\nerror: \u274c Neo4j connection failed\n"})}),"\n",(0,o.jsx)(n.h3,{id:"json-output-production",children:"JSON Output (Production)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\r\n  "level": "info",\r\n  "message": "Camera fetched",\r\n  "service": "uip-traffic-backend",\r\n  "timestamp": "2025-01-15T10:30:00.000Z",\r\n  "cameraId": "urn:ngsi-ld:Camera:001",\r\n  "responseTime": 125\r\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"error-log",children:"Error Log"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\r\n  "level": "error",\r\n  "message": "Database connection failed",\r\n  "service": "uip-traffic-backend",\r\n  "timestamp": "2025-01-15T10:30:00.000Z",\r\n  "error": {\r\n    "message": "Connection refused",\r\n    "stack": "Error: Connection refused\\n    at PostgresService..."\r\n  }\r\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"environment-configuration",children:"Environment Configuration"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# .env\r\nLOG_LEVEL=debug      # Logging level\r\nLOG_FORMAT=json      # Output format (json/simple)\r\nLOG_DIR=./logs       # Log directory\n"})}),"\n",(0,o.jsx)(n.h2,{id:"log-file-rotation",children:"Log File Rotation"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"// Daily rotation with Winston DailyRotateFile\r\nimport DailyRotateFile from 'winston-daily-rotate-file';\r\n\r\nconst rotateTransport = new DailyRotateFile({\r\n  filename: 'logs/application-%DATE%.log',\r\n  datePattern: 'YYYY-MM-DD',\r\n  maxSize: '20m',     // Rotate at 20MB\r\n  maxFiles: '14d',    // Keep 14 days\r\n  zippedArchive: true\r\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/tes/docs/backend/overview",children:"Backend Overview"})," - Server architecture"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/tes/docs/backend/middlewares/error-handler",children:"Error Handler"})," - Error handling"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/winstonjs/winston",children:"Winston Documentation"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://blog.logrocket.com/node-js-logging-best-practices/",children:"Node.js Logging Best Practices"})}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>l});var t=r(6540);const o={},s=t.createContext(o);function i(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);