"use strict";(globalThis.webpackChunkuip_urban_intelligence_platform_docs=globalThis.webpackChunkuip_urban_intelligence_platform_docs||[]).push([[3460],{4799:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>c,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"backend/utils/health-check","title":"Health Check Utility","description":"Health check utility for monitoring service connectivity to Stellio, Neo4j, Fuseki, PostgreSQL and external APIs.","source":"@site/docs/backend/utils/healthCheck.md","sourceDirName":"backend/utils","slug":"/backend/utils/health-check","permalink":"/tes/docs/backend/utils/health-check","draft":false,"unlisted":false,"editUrl":"https://github.com/NguyenNhatquang522004/UIP-Urban_Intelligence_Platform/tree/main/apps/traffic-web-app/frontend/docs/docs/backend/utils/healthCheck.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"health-check","title":"Health Check Utility","sidebar_label":"Health Check","sidebar_position":3,"description":"Health check utility for monitoring service connectivity to Stellio, Neo4j, Fuseki, PostgreSQL and external APIs.","keywords":["health-check","monitoring","connectivity","status","liveness","readiness"]}}');var s=r(4848),i=r(8453);const c={id:"health-check",title:"Health Check Utility",sidebar_label:"Health Check",sidebar_position:3,description:"Health check utility for monitoring service connectivity to Stellio, Neo4j, Fuseki, PostgreSQL and external APIs.",keywords:["health-check","monitoring","connectivity","status","liveness","readiness"]},l="Health Check Utility",a={},h=[{value:"Overview",id:"overview",level:2},{value:"Features",id:"features",level:2},{value:"API Endpoint",id:"api-endpoint",level:2},{value:"GET /api/health",id:"get-apihealth",level:3},{value:"Implementation",id:"implementation",level:2},{value:"Individual Health Checks",id:"individual-health-checks",level:2},{value:"Stellio Health Check",id:"stellio-health-check",level:3},{value:"Neo4j Health Check",id:"neo4j-health-check",level:3},{value:"PostgreSQL Health Check",id:"postgresql-health-check",level:3},{value:"Status Determination",id:"status-determination",level:2},{value:"Kubernetes Probes",id:"kubernetes-probes",level:2},{value:"Docker Health Check",id:"docker-health-check",level:2},{value:"Monitoring Integration",id:"monitoring-integration",level:2},{value:"Related Documentation",id:"related-documentation",level:2},{value:"References",id:"references",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"health-check-utility",children:"Health Check Utility"})}),"\n",(0,s.jsxs)(n.p,{children:["Health check utility for monitoring ",(0,s.jsx)(n.strong,{children:"service connectivity"})," to Stellio, Neo4j, Fuseki, PostgreSQL, and external APIs."]}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mermaid",children:"graph TB\r\n    subgraph HealthCheck\r\n        CHECK[Health Checker]\r\n        AGGREGATE[Aggregator]\r\n    end\r\n    \r\n    subgraph Services\r\n        STELLIO[Stellio]\r\n        NEO4J[Neo4j]\r\n        FUSEKI[Fuseki]\r\n        POSTGRES[PostgreSQL]\r\n    end\r\n    \r\n    subgraph External\r\n        GEMINI[Gemini API]\r\n        TAVILY[Tavily API]\r\n    end\r\n    \r\n    CHECK --\x3e STELLIO\r\n    CHECK --\x3e NEO4J\r\n    CHECK --\x3e FUSEKI\r\n    CHECK --\x3e POSTGRES\r\n    CHECK --\x3e GEMINI\r\n    CHECK --\x3e TAVILY\r\n    \r\n    STELLIO --\x3e AGGREGATE\r\n    NEO4J --\x3e AGGREGATE\r\n    FUSEKI --\x3e AGGREGATE\r\n    POSTGRES --\x3e AGGREGATE\r\n    GEMINI --\x3e AGGREGATE\r\n    TAVILY --\x3e AGGREGATE\n"})}),"\n",(0,s.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Feature"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Liveness Probe"})}),(0,s.jsx)(n.td,{children:"Is the server running?"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Readiness Probe"})}),(0,s.jsx)(n.td,{children:"Is the server ready for requests?"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Dependency Check"})}),(0,s.jsx)(n.td,{children:"Individual service status"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Timeout Handling"})}),(0,s.jsx)(n.td,{children:"5s timeout per check"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Aggregate Status"})}),(0,s.jsx)(n.td,{children:"Overall health determination"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"api-endpoint",children:"API Endpoint"}),"\n",(0,s.jsx)(n.h3,{id:"get-apihealth",children:"GET /api/health"}),"\n",(0,s.jsx)(n.p,{children:"Returns overall health status and individual service statuses."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response (Healthy):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "healthy",\r\n  "timestamp": "2025-01-15T10:30:00.000Z",\r\n  "uptime": 3600,\r\n  "services": {\r\n    "stellio": {\r\n      "status": "connected",\r\n      "latency": 45,\r\n      "version": "1.5.0"\r\n    },\r\n    "neo4j": {\r\n      "status": "connected",\r\n      "latency": 28\r\n    },\r\n    "fuseki": {\r\n      "status": "connected",\r\n      "latency": 35\r\n    },\r\n    "postgres": {\r\n      "status": "connected",\r\n      "latency": 12\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response (Degraded):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "degraded",\r\n  "timestamp": "2025-01-15T10:30:00.000Z",\r\n  "uptime": 3600,\r\n  "services": {\r\n    "stellio": {\r\n      "status": "connected",\r\n      "latency": 45\r\n    },\r\n    "neo4j": {\r\n      "status": "error",\r\n      "error": "Connection refused",\r\n      "lastSuccess": "2025-01-15T10:25:00.000Z"\r\n    },\r\n    "fuseki": {\r\n      "status": "connected",\r\n      "latency": 35\r\n    },\r\n    "postgres": {\r\n      "status": "connected",\r\n      "latency": 12\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"implementation",children:"Implementation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// utils/healthCheck.ts\r\nexport interface ServiceHealth {\r\n  status: 'connected' | 'error' | 'timeout';\r\n  latency?: number;\r\n  error?: string;\r\n  version?: string;\r\n  lastSuccess?: string;\r\n}\r\n\r\nexport interface HealthCheckResult {\r\n  status: 'healthy' | 'degraded' | 'unhealthy';\r\n  timestamp: string;\r\n  uptime: number;\r\n  services: Record<string, ServiceHealth>;\r\n}\r\n\r\nexport async function performHealthCheck(): Promise<HealthCheckResult> {\r\n  const startTime = Date.now();\r\n  \r\n  const [stellio, neo4j, fuseki, postgres] = await Promise.all([\r\n    checkStellioHealth(),\r\n    checkNeo4jHealth(),\r\n    checkFusekiHealth(),\r\n    checkPostgresHealth()\r\n  ]);\r\n  \r\n  const services = { stellio, neo4j, fuseki, postgres };\r\n  const status = determineOverallStatus(services);\r\n  \r\n  return {\r\n    status,\r\n    timestamp: new Date().toISOString(),\r\n    uptime: process.uptime(),\r\n    services\r\n  };\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"individual-health-checks",children:"Individual Health Checks"}),"\n",(0,s.jsx)(n.h3,{id:"stellio-health-check",children:"Stellio Health Check"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"async function checkStellioHealth(): Promise<ServiceHealth> {\r\n  const start = Date.now();\r\n  try {\r\n    const response = await axios.get(`${STELLIO_URL}/health`, {\r\n      timeout: 5000\r\n    });\r\n    return {\r\n      status: 'connected',\r\n      latency: Date.now() - start,\r\n      version: response.data.version\r\n    };\r\n  } catch (error) {\r\n    return {\r\n      status: 'error',\r\n      error: error.message\r\n    };\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"neo4j-health-check",children:"Neo4j Health Check"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"async function checkNeo4jHealth(): Promise<ServiceHealth> {\r\n  const start = Date.now();\r\n  try {\r\n    const session = driver.session();\r\n    await session.run('RETURN 1');\r\n    await session.close();\r\n    return {\r\n      status: 'connected',\r\n      latency: Date.now() - start\r\n    };\r\n  } catch (error) {\r\n    return {\r\n      status: 'error',\r\n      error: error.message\r\n    };\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"postgresql-health-check",children:"PostgreSQL Health Check"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"async function checkPostgresHealth(): Promise<ServiceHealth> {\r\n  const start = Date.now();\r\n  try {\r\n    await pool.query('SELECT 1');\r\n    return {\r\n      status: 'connected',\r\n      latency: Date.now() - start\r\n    };\r\n  } catch (error) {\r\n    return {\r\n      status: 'error',\r\n      error: error.message\r\n    };\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"status-determination",children:"Status Determination"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"function determineOverallStatus(\r\n  services: Record<string, ServiceHealth>\r\n): 'healthy' | 'degraded' | 'unhealthy' {\r\n  const statuses = Object.values(services).map(s => s.status);\r\n  \r\n  // Unhealthy: Stellio (critical service) is down\r\n  if (services.stellio.status !== 'connected') {\r\n    return 'unhealthy';\r\n  }\r\n  \r\n  // Degraded: Any non-critical service is down\r\n  if (statuses.some(s => s !== 'connected')) {\r\n    return 'degraded';\r\n  }\r\n  \r\n  // Healthy: All services connected\r\n  return 'healthy';\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"kubernetes-probes",children:"Kubernetes Probes"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# k8s-deployment.yaml\r\nlivenessProbe:\r\n  httpGet:\r\n    path: /api/health\r\n    port: 5000\r\n  initialDelaySeconds: 30\r\n  periodSeconds: 10\r\n\r\nreadinessProbe:\r\n  httpGet:\r\n    path: /api/health\r\n    port: 5000\r\n  initialDelaySeconds: 5\r\n  periodSeconds: 5\n"})}),"\n",(0,s.jsx)(n.h2,{id:"docker-health-check",children:"Docker Health Check"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"# Dockerfile\r\nHEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \\\r\n  CMD curl -f http://localhost:5000/api/health || exit 1\n"})}),"\n",(0,s.jsx)(n.h2,{id:"monitoring-integration",children:"Monitoring Integration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Prometheus metrics\r\napp.get('/metrics', async (req, res) => {\r\n  const health = await performHealthCheck();\r\n  \r\n  const metrics = `\r\n# HELP service_health Service health status\r\n# TYPE service_health gauge\r\nservice_health{service=\"stellio\"} ${health.services.stellio.status === 'connected' ? 1 : 0}\r\nservice_health{service=\"neo4j\"} ${health.services.neo4j.status === 'connected' ? 1 : 0}\r\nservice_health{service=\"fuseki\"} ${health.services.fuseki.status === 'connected' ? 1 : 0}\r\nservice_health{service=\"postgres\"} ${health.services.postgres.status === 'connected' ? 1 : 0}\r\n\r\n# HELP service_latency_ms Service response latency in milliseconds\r\n# TYPE service_latency_ms gauge\r\nservice_latency_ms{service=\"stellio\"} ${health.services.stellio.latency || 0}\r\nservice_latency_ms{service=\"neo4j\"} ${health.services.neo4j.latency || 0}\r\n  `;\r\n  \r\n  res.type('text/plain').send(metrics);\r\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/tes/docs/backend/overview",children:"Backend Overview"})," - Server architecture"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/tes/docs/backend/services/stellio-service",children:"Services"})," - Service layer"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/tes/docs/backend/utils/logger",children:"Logger"})," - Health logging"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/",children:"Kubernetes Health Probes"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.docker.com/engine/reference/builder/#healthcheck",children:"Docker HEALTHCHECK"})}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>l});var t=r(6540);const s={},i=t.createContext(s);function c(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);