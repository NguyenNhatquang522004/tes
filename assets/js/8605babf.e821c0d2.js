"use strict";(globalThis.webpackChunkuip_urban_intelligence_platform_docs=globalThis.webpackChunkuip_urban_intelligence_platform_docs||[]).push([[3679],{8434:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"agents/notification/subscription-manager","title":"subscription-manager","description":"\x3c!--","source":"@site/docs/agents/notification/subscription-manager.md","sourceDirName":"agents/notification","slug":"/agents/notification/subscription-manager","permalink":"/tes/docs/agents/notification/subscription-manager","draft":false,"unlisted":false,"editUrl":"https://github.com/NguyenNhatquang522004/UIP-Urban_Intelligence_Platform/tree/main/apps/traffic-web-app/frontend/docs/docs/agents/notification/subscription-manager.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"incident-report-generator","permalink":"/tes/docs/agents/notification/incident-report-generator"},"next":{"title":"webhook-notification-handler","permalink":"/tes/docs/agents/notification/webhook-notification-handler"}}');var t=i(4848),s=i(8453);const c={sidebar_position:4},a="Subscription Manager Agent",o={},l=[{value:"\ud83d\udccb Overview",id:"-overview",level:2},{value:"\ud83c\udfaf Purpose",id:"-purpose",level:2},{value:"\ud83d\ude80 Usage",id:"-usage",level:2},{value:"Create Subscription",id:"create-subscription",level:3},{value:"User Subscription",id:"user-subscription",level:3},{value:"List Subscriptions",id:"list-subscriptions",level:3},{value:"\u2699\ufe0f Configuration",id:"\ufe0f-configuration",level:2},{value:"\ud83d\udcca Subscription Types",id:"-subscription-types",level:2},{value:"\ud83d\udd04 Subscription Lifecycle",id:"-subscription-lifecycle",level:2},{value:"\ud83d\udcd6 Related Documentation",id:"-related-documentation",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"subscription-manager-agent",children:"Subscription Manager Agent"})}),"\n",(0,t.jsx)(n.p,{children:"The Subscription Manager Agent handles NGSI-LD subscriptions and user notification preferences."}),"\n",(0,t.jsx)(n.h2,{id:"-overview",children:"\ud83d\udccb Overview"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Property"}),(0,t.jsx)(n.th,{children:"Value"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Module"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"src.agents.notification.subscription_manager_agent"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Class"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SubscriptionManagerAgent"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Author"})}),(0,t.jsx)(n.td,{children:"UIP Team"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Version"})}),(0,t.jsx)(n.td,{children:"1.0.0"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"-purpose",children:"\ud83c\udfaf Purpose"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Manage NGSI-LD subscriptions"})," in Stellio"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Handle user notification preferences"})," by topic"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Route notifications"})," to appropriate handlers"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Track subscription lifecycle"})," and health"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"-usage",children:"\ud83d\ude80 Usage"}),"\n",(0,t.jsx)(n.h3,{id:"create-subscription",children:"Create Subscription"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from src.agents.notification.subscription_manager_agent import SubscriptionManagerAgent\r\n\r\nmanager = SubscriptionManagerAgent()\r\n\r\n# Create NGSI-LD subscription\r\nsubscription = await manager.create_subscription({\r\n    "type": "Subscription",\r\n    "entities": [{"type": "TrafficCamera"}],\r\n    "watchedAttributes": ["status", "vehicleCount"],\r\n    "notification": {\r\n        "endpoint": {\r\n            "uri": "http://localhost:8080/notifications"\r\n        }\r\n    },\r\n    "q": "vehicleCount>100"\r\n})\n'})}),"\n",(0,t.jsx)(n.h3,{id:"user-subscription",children:"User Subscription"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# Subscribe user to alerts\r\nawait manager.subscribe_user(\r\n    user_id="USER_001",\r\n    topics=["accidents", "congestion"],\r\n    channels=["email", "push"],\r\n    preferences={\r\n        "severity_threshold": "medium",\r\n        "zones": ["district_1"]\r\n    }\r\n)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"list-subscriptions",children:"List Subscriptions"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# Get all active subscriptions\r\nsubscriptions = await manager.list_subscriptions()\r\n\r\n# Get user\'s subscriptions\r\nuser_subs = await manager.get_user_subscriptions("USER_001")\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\ufe0f-configuration",children:"\u2699\ufe0f Configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'# config/subscriptions.yaml\r\nsubscription_manager:\r\n  enabled: true\r\n  \r\n  # Stellio settings\r\n  stellio:\r\n    url: "http://localhost:8080"\r\n    subscription_endpoint: "/ngsi-ld/v1/subscriptions"\r\n  \r\n  # Default subscription settings\r\n  defaults:\r\n    throttling: 5  # seconds\r\n    expires_in_days: 30\r\n    notification_format: "normalized"\r\n  \r\n  # Topics\r\n  topics:\r\n    accidents:\r\n      entity_type: "TrafficAccident"\r\n      attributes: ["severity", "location", "status"]\r\n    congestion:\r\n      entity_type: "CongestionZone"\r\n      attributes: ["level", "affectedRoads"]\n'})}),"\n",(0,t.jsx)(n.h2,{id:"-subscription-types",children:"\ud83d\udcca Subscription Types"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Notification"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"entity_changes"})}),(0,t.jsx)(n.td,{children:"Track entity updates"}),(0,t.jsx)(n.td,{children:"Real-time"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"threshold_alerts"})}),(0,t.jsx)(n.td,{children:"Value exceeds threshold"}),(0,t.jsx)(n.td,{children:"Immediate"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"scheduled_reports"})}),(0,t.jsx)(n.td,{children:"Periodic summaries"}),(0,t.jsx)(n.td,{children:"Scheduled"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"geofence_events"})}),(0,t.jsx)(n.td,{children:"Location-based"}),(0,t.jsx)(n.td,{children:"Real-time"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"-subscription-lifecycle",children:"\ud83d\udd04 Subscription Lifecycle"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mermaid",children:"graph LR\r\n    A[Create] --\x3e B[Active]\r\n    B --\x3e C[Triggered]\r\n    C --\x3e B\r\n    B --\x3e D[Paused]\r\n    D --\x3e B\r\n    B --\x3e E[Expired]\r\n    E --\x3e F[Deleted]\n"})}),"\n",(0,t.jsx)(n.h2,{id:"-related-documentation",children:"\ud83d\udcd6 Related Documentation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"alert-dispatcher",children:"Alert Dispatcher"})," - Notification routing"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"email-notification-handler",children:"Email Handler"})," - Email delivery"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"webhook-notification-handler",children:"Webhook Handler"})," - Webhook delivery"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.p,{children:["See the ",(0,t.jsx)(n.a,{href:"../complete-agents-reference",children:"complete agents reference"})," for all available agents."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>a});var r=i(6540);const t={},s=r.createContext(t);function c(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);