"use strict";(globalThis.webpackChunkuip_urban_intelligence_platform_docs=globalThis.webpackChunkuip_urban_intelligence_platform_docs||[]).push([[9988],{563:e=>{e.exports=JSON.parse('{"permalink":"/tes/blog/performance-optimization","editUrl":"https://github.com/NguyenNhatquang522004/UIP-Urban_Intelligence_Platform/tree/main/apps/traffic-web-app/frontend/docs/blog/2024-07-01-performance-optimization.md","source":"@site/blog/2024-07-01-performance-optimization.md","title":"\u26a1 T\u1ed1i \u01b0u Performance cho 1000+ Camera Streams","description":"\x3c!--","date":"2024-07-01T00:00:00.000Z","tags":[{"inline":false,"label":"UIP","permalink":"/tes/blog/tags/uip","description":"UIP - Urban Intelligence Platform core content"},{"inline":true,"label":"performance","permalink":"/tes/blog/tags/performance"},{"inline":true,"label":"optimization","permalink":"/tes/blog/tags/optimization"},{"inline":false,"label":"Python","permalink":"/tes/blog/tags/python","description":"Python programming and best practices"},{"inline":false,"label":"Backend","permalink":"/tes/blog/tags/backend","description":"Backend development and APIs"}],"readingTime":4.2,"hasTruncateMarker":true,"authors":[{"name":"Nguy\u1ec5n Nh\u1eadt Quang","title":"Lead Developer & System Architect","url":"https://github.com/NguyenNhatquang522004","page":{"permalink":"/tes/blog/authors/nguyennhatquang"},"socials":{"github":"https://github.com/NguyenNhatquang522004","email":"mailto:nguyennhatquang522004@gmail.com"},"imageURL":"https://github.com/NguyenNhatquang522004.png","key":"nguyennhatquang"},{"name":"Nguy\u1ec5n \u0110\xecnh Anh Tu\u1ea5n","title":"Backend Developer","url":"https://github.com/NguyenDinhAnhTuan04","page":{"permalink":"/tes/blog/authors/nguyendinhanhtuan"},"socials":{"github":"https://github.com/NguyenDinhAnhTuan04","email":"mailto:nguyentuan834897@gmail.com"},"imageURL":"https://github.com/NguyenDinhAnhTuan04.png","key":"nguyendinhanhtuan"}],"frontMatter":{"slug":"performance-optimization","title":"\u26a1 T\u1ed1i \u01b0u Performance cho 1000+ Camera Streams","authors":["nguyennhatquang","nguyendinhanhtuan"],"tags":["uip","performance","optimization","python","backend"]},"unlisted":false,"nextItem":{"title":"\ud83d\udcf1 X\xe2y d\u1ef1ng H\u1ec7 th\u1ed1ng B\xe1o c\xe1o C\xf4ng d\xe2n","permalink":"/tes/blog/citizen-reporting-system"}}')},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>l});var i=t(6540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}},9179:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>o});var i=t(563),s=t(4848),r=t(8453);const a={slug:"performance-optimization",title:"\u26a1 T\u1ed1i \u01b0u Performance cho 1000+ Camera Streams",authors:["nguyennhatquang","nguyendinhanhtuan"],tags:["uip","performance","optimization","python","backend"]},l=void 0,c={authorsImageUrls:[void 0,void 0]},o=[{value:"\ud83d\udcca Th\xe1ch th\u1ee9c ban \u0111\u1ea7u",id:"-th\xe1ch-th\u1ee9c-ban-\u0111\u1ea7u",level:2},{value:"\ud83d\udd27 Optimization Techniques",id:"-optimization-techniques",level:2},{value:"1. Async Everything",id:"1-async-everything",level:3},{value:"2. Connection Pooling",id:"2-connection-pooling",level:3},{value:"3. Batch Processing",id:"3-batch-processing",level:3},{value:"4. Smart Caching",id:"4-smart-caching",level:3},{value:"5. Lazy Loading &amp; Pagination",id:"5-lazy-loading--pagination",level:3},{value:"6. Worker Pool Pattern",id:"6-worker-pool-pattern",level:3},{value:"\ud83d\udcc8 Results After Optimization",id:"-results-after-optimization",level:2},{value:"\ud83d\udd0d Profiling Tools",id:"-profiling-tools",level:2},{value:"Memory Profiling",id:"memory-profiling",level:3},{value:"CPU Profiling",id:"cpu-profiling",level:3},{value:"Async Tracing",id:"async-tracing",level:3},{value:"\ud83d\udccb Performance Checklist",id:"-performance-checklist",level:2},{value:"\ud83c\udf93 Key Takeaways",id:"-key-takeaways",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["X\u1eed l\xfd real-time data t\u1eeb ",(0,s.jsx)(n.strong,{children:"1000+ camera"})," l\xe0 th\xe1ch th\u1ee9c kh\xf4ng nh\u1ecf. B\xe0i vi\u1ebft n\xe0y chia s\u1ebb c\xe1c k\u1ef9 thu\u1eadt t\u1ed1i \u01b0u performance m\xe0 UIP team \u0111\xe3 \xe1p d\u1ee5ng."]}),"\n",(0,s.jsx)(n.h2,{id:"-th\xe1ch-th\u1ee9c-ban-\u0111\u1ea7u",children:"\ud83d\udcca Th\xe1ch th\u1ee9c ban \u0111\u1ea7u"}),"\n",(0,s.jsx)(n.p,{children:"Khi scale t\u1eeb 100 l\xean 1000 camera, ch\xfang t\xf4i g\u1eb7p c\xe1c v\u1ea5n \u0111\u1ec1:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Metric"}),(0,s.jsx)(n.th,{children:"100 cameras"}),(0,s.jsx)(n.th,{children:"1000 cameras"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Memory"}),(0,s.jsx)(n.td,{children:"2GB"}),(0,s.jsx)(n.td,{children:"25GB \u274c"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"CPU"}),(0,s.jsx)(n.td,{children:"40%"}),(0,s.jsx)(n.td,{children:"95% \u274c"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Latency"}),(0,s.jsx)(n.td,{children:"500ms"}),(0,s.jsx)(n.td,{children:"8s \u274c"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Error rate"}),(0,s.jsx)(n.td,{children:"0.1%"}),(0,s.jsx)(n.td,{children:"12% \u274c"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"M\u1ee5c ti\xeau:"})," X\u1eed l\xfd 1000+ camera v\u1edbi latency < 1s"]}),"\n",(0,s.jsx)(n.h2,{id:"-optimization-techniques",children:"\ud83d\udd27 Optimization Techniques"}),"\n",(0,s.jsx)(n.h3,{id:"1-async-everything",children:"1. Async Everything"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Before (Sync):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"def process_cameras(cameras: List[Camera]) -> List[Result]:\n    results = []\n    for camera in cameras:\n        image = fetch_image(camera.url)  # Blocking!\n        result = analyze(image)\n        results.append(result)\n    return results\n# Time: 1000 cameras \xd7 500ms = 500s \ud83d\ude31\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"After (Async):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"async def process_cameras(cameras: List[Camera]) -> List[Result]:\n    tasks = [process_single(cam) for cam in cameras]\n    results = await asyncio.gather(*tasks, return_exceptions=True)\n    return [r for r in results if not isinstance(r, Exception)]\n\nasync def process_single(camera: Camera) -> Result:\n    async with aiohttp.ClientSession() as session:\n        async with session.get(camera.url) as response:\n            image = await response.read()\n    return await analyze_async(image)\n# Time: ~2-3s total \ud83d\ude80\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-connection-pooling",children:"2. Connection Pooling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Global connection pool\nclass ConnectionManager:\n    def __init__(self):\n        self.http_pool = aiohttp.TCPConnector(\n            limit=500,           # Max connections\n            limit_per_host=10,   # Per host limit\n            ttl_dns_cache=300,   # DNS cache TTL\n            keepalive_timeout=30\n        )\n        self.mongo_pool = AsyncIOMotorClient(\n            maxPoolSize=100,\n            minPoolSize=10,\n            waitQueueTimeoutMS=5000\n        )\n        self.redis_pool = redis.ConnectionPool(\n            max_connections=50,\n            timeout=5\n        )\n    \n    async def get_session(self) -> aiohttp.ClientSession:\n        return aiohttp.ClientSession(connector=self.http_pool)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-batch-processing",children:"3. Batch Processing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'async def batch_process(items: List[Item], batch_size: int = 100):\n    """Process items in batches to control resource usage"""\n    results = []\n    \n    for i in range(0, len(items), batch_size):\n        batch = items[i:i + batch_size]\n        \n        # Process batch concurrently\n        batch_results = await asyncio.gather(*[\n            process_item(item) for item in batch\n        ])\n        \n        results.extend(batch_results)\n        \n        # Small delay between batches to prevent overwhelming\n        await asyncio.sleep(0.1)\n    \n    return results\n'})}),"\n",(0,s.jsx)(n.h3,{id:"4-smart-caching",children:"4. Smart Caching"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from functools import lru_cache\nfrom cachetools import TTLCache\nimport redis.asyncio as redis\n\nclass MultiLevelCache:\n    def __init__(self):\n        # L1: In-memory (fastest)\n        self.l1_cache = TTLCache(maxsize=1000, ttl=60)\n        \n        # L2: Redis (shared across instances)\n        self.redis = redis.Redis(\n            host='redis',\n            port=6379,\n            decode_responses=True\n        )\n    \n    async def get(self, key: str) -> Optional[Any]:\n        # Try L1 first\n        if key in self.l1_cache:\n            return self.l1_cache[key]\n        \n        # Try L2\n        value = await self.redis.get(key)\n        if value:\n            self.l1_cache[key] = json.loads(value)\n            return self.l1_cache[key]\n        \n        return None\n    \n    async def set(self, key: str, value: Any, ttl: int = 300):\n        self.l1_cache[key] = value\n        await self.redis.setex(key, ttl, json.dumps(value))\n"})}),"\n",(0,s.jsx)(n.h3,{id:"5-lazy-loading--pagination",children:"5. Lazy Loading & Pagination"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'async def get_cameras_paginated(\n    page: int = 1,\n    limit: int = 100,\n    filters: Optional[CameraFilter] = None\n) -> PaginatedResponse:\n    """Paginated camera fetching with cursor-based pagination"""\n    \n    skip = (page - 1) * limit\n    \n    # Build query\n    query = {}\n    if filters:\n        if filters.status:\n            query["status"] = filters.status\n        if filters.district:\n            query["location.district"] = filters.district\n    \n    # Execute with projection (only needed fields)\n    cameras = await db.cameras.find(\n        query,\n        projection={\n            "_id": 1,\n            "name": 1,\n            "location": 1,\n            "status": 1,\n            "lastUpdate": 1\n        }\n    ).skip(skip).limit(limit).to_list(limit)\n    \n    total = await db.cameras.count_documents(query)\n    \n    return PaginatedResponse(\n        items=cameras,\n        total=total,\n        page=page,\n        limit=limit,\n        pages=math.ceil(total / limit)\n    )\n'})}),"\n",(0,s.jsx)(n.h3,{id:"6-worker-pool-pattern",children:"6. Worker Pool Pattern"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'import asyncio\nfrom asyncio import Queue\n\nclass WorkerPool:\n    def __init__(self, num_workers: int = 10):\n        self.num_workers = num_workers\n        self.queue: Queue = Queue()\n        self.workers: List[asyncio.Task] = []\n    \n    async def start(self):\n        """Start worker pool"""\n        for i in range(self.num_workers):\n            worker = asyncio.create_task(self._worker(i))\n            self.workers.append(worker)\n    \n    async def _worker(self, worker_id: int):\n        """Individual worker process"""\n        while True:\n            job = await self.queue.get()\n            try:\n                await job.execute()\n            except Exception as e:\n                logger.error(f"Worker {worker_id} error: {e}")\n            finally:\n                self.queue.task_done()\n    \n    async def submit(self, job: Job):\n        """Submit job to queue"""\n        await self.queue.put(job)\n    \n    async def wait_completion(self):\n        """Wait for all jobs to complete"""\n        await self.queue.join()\n'})}),"\n",(0,s.jsx)(n.h2,{id:"-results-after-optimization",children:"\ud83d\udcc8 Results After Optimization"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Metric"}),(0,s.jsx)(n.th,{children:"Before"}),(0,s.jsx)(n.th,{children:"After"}),(0,s.jsx)(n.th,{children:"Improvement"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Memory"}),(0,s.jsx)(n.td,{children:"25GB"}),(0,s.jsx)(n.td,{children:"4GB"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"84% \u2193"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"CPU"}),(0,s.jsx)(n.td,{children:"95%"}),(0,s.jsx)(n.td,{children:"45%"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"53% \u2193"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Latency"}),(0,s.jsx)(n.td,{children:"8s"}),(0,s.jsx)(n.td,{children:"800ms"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"90% \u2193"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Error rate"}),(0,s.jsx)(n.td,{children:"12%"}),(0,s.jsx)(n.td,{children:"0.5%"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"96% \u2193"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Throughput"}),(0,s.jsx)(n.td,{children:"2 req/s"}),(0,s.jsx)(n.td,{children:"150 req/s"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"75x \u2191"})})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"-profiling-tools",children:"\ud83d\udd0d Profiling Tools"}),"\n",(0,s.jsx)(n.h3,{id:"memory-profiling",children:"Memory Profiling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from memory_profiler import profile\n\n@profile\ndef memory_intensive_function():\n    # Your code here\n    pass\n\n# Run with: python -m memory_profiler script.py\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cpu-profiling",children:"CPU Profiling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import cProfile\nimport pstats\n\ndef profile_function(func):\n    profiler = cProfile.Profile()\n    profiler.enable()\n    \n    result = func()\n    \n    profiler.disable()\n    stats = pstats.Stats(profiler)\n    stats.sort_stats('cumulative')\n    stats.print_stats(20)\n    \n    return result\n"})}),"\n",(0,s.jsx)(n.h3,{id:"async-tracing",children:"Async Tracing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'import opentelemetry\nfrom opentelemetry import trace\nfrom opentelemetry.sdk.trace import TracerProvider\n\n# Setup tracer\ntrace.set_tracer_provider(TracerProvider())\ntracer = trace.get_tracer(__name__)\n\nasync def traced_operation():\n    with tracer.start_as_current_span("camera_processing"):\n        with tracer.start_as_current_span("fetch_image"):\n            image = await fetch_image()\n        \n        with tracer.start_as_current_span("analyze"):\n            result = await analyze(image)\n        \n        return result\n'})}),"\n",(0,s.jsx)(n.h2,{id:"-performance-checklist",children:"\ud83d\udccb Performance Checklist"}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Use ",(0,s.jsx)(n.code,{children:"async/await"})," for I/O operations"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Implement connection pooling"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Add multi-level caching (L1: memory, L2: Redis)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Use batch processing for bulk operations"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Implement pagination for large datasets"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Profile before optimizing"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Monitor in production"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"-key-takeaways",children:"\ud83c\udf93 Key Takeaways"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Async is essential"})," - Kh\xf4ng th\u1ec3 scale v\u1edbi sync code"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cache aggressively"})," - Multi-level cache gi\u1ea3m load \u0111\xe1ng k\u1ec3"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Batch processing"})," - Ki\u1ec3m so\xe1t resource usage"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Profile first"})," - \u0110o l\u01b0\u1eddng tr\u01b0\u1edbc khi optimize"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Connection pooling"})," - T\xe1i s\u1eed d\u1ee5ng connections"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"B\u1ea1n c\xf3 tips optimization n\xe0o kh\xe1c?"})," Chia s\u1ebb trong ",(0,s.jsx)(n.a,{href:"https://github.com/NguyenNhatquang522004/UIP-Urban_Intelligence_Platform/discussions",children:"Discussions"}),"!"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Nguy\u1ec5n Nh\u1eadt Quang & Nguy\u1ec5n \u0110\xecnh Anh Tu\u1ea5n - UIP Team"})})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);