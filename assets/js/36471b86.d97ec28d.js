"use strict";(globalThis.webpackChunkuip_urban_intelligence_platform_docs=globalThis.webpackChunkuip_urban_intelligence_platform_docs||[]).push([[2760],{7370:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"agents/graph-database/neo4j-sync","title":"neo4j-sync","description":"\x3c!--","source":"@site/docs/agents/graph-database/neo4j-sync.md","sourceDirName":"agents/graph-database","slug":"/agents/graph-database/neo4j-sync","permalink":"/tes/docs/agents/graph-database/neo4j-sync","draft":false,"unlisted":false,"editUrl":"https://github.com/NguyenNhatquang522004/UIP-Urban_Intelligence_Platform/tree/main/apps/traffic-web-app/frontend/docs/docs/agents/graph-database/neo4j-sync.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"cache-invalidator","permalink":"/tes/docs/agents/cache/cache-invalidator"},"next":{"title":"neo4j-query","permalink":"/tes/docs/agents/graph-database/neo4j-query"}}');var i=r(4848),a=r(8453);const s={sidebar_position:1},c="Neo4j Sync Agent",d={},l=[{value:"\ud83d\udccb Overview",id:"-overview",level:2},{value:"\ud83c\udfaf Purpose",id:"-purpose",level:2},{value:"\ud83d\udcca Graph Schema",id:"-graph-schema",level:2},{value:"Node Types",id:"node-types",level:3},{value:"Relationship Types",id:"relationship-types",level:3},{value:"\ud83d\udd27 Architecture",id:"-architecture",level:2},{value:"\ud83d\ude80 Usage",id:"-usage",level:2},{value:"Basic Synchronization",id:"basic-synchronization",level:3},{value:"Batch Synchronization",id:"batch-synchronization",level:3},{value:"Query Graph",id:"query-graph",level:3},{value:"\u2699\ufe0f Configuration",id:"\ufe0f-configuration",level:2},{value:"Environment Variables",id:"environment-variables",level:3},{value:"YAML Configuration",id:"yaml-configuration",level:3},{value:"\ud83d\udcc8 Cypher Query Examples",id:"-cypher-query-examples",level:2},{value:"Find Traffic Patterns",id:"find-traffic-patterns",level:3},{value:"Spatial Queries",id:"spatial-queries",level:3},{value:"Pattern Correlation",id:"pattern-correlation",level:3},{value:"\ud83d\udee1\ufe0f Error Handling",id:"\ufe0f-error-handling",level:2},{value:"\ud83d\udcd6 Related Documentation",id:"-related-documentation",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"neo4j-sync-agent",children:"Neo4j Sync Agent"})}),"\n",(0,i.jsx)(n.p,{children:"The Neo4j Sync Agent synchronizes traffic entities and relationships to Neo4j graph database for advanced relationship queries and graph-based analytics."}),"\n",(0,i.jsx)(n.h2,{id:"-overview",children:"\ud83d\udccb Overview"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Value"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Module"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"src.agents.graph_database.neo4j_sync_agent"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Class"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Neo4jSyncAgent"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Author"})}),(0,i.jsx)(n.td,{children:"Nguyen Viet Hoang"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Version"})}),(0,i.jsx)(n.td,{children:"1.0.0"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"-purpose",children:"\ud83c\udfaf Purpose"}),"\n",(0,i.jsx)(n.p,{children:"The Neo4j Sync Agent enables:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Graph-based relationships"})," between traffic entities"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Advanced pattern queries"})," using Cypher"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Spatial analytics"})," with geographic relationships"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Real-time graph updates"})," from streaming data"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-graph-schema",children:"\ud83d\udcca Graph Schema"}),"\n",(0,i.jsx)(n.h3,{id:"node-types",children:"Node Types"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Node Label"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Properties"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Camera"})}),(0,i.jsx)(n.td,{children:"Traffic camera"}),(0,i.jsx)(n.td,{children:"id, name, location, status"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Observation"})}),(0,i.jsx)(n.td,{children:"Traffic observation"}),(0,i.jsx)(n.td,{children:"id, timestamp, vehicle_count, speed"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Accident"})}),(0,i.jsx)(n.td,{children:"Accident event"}),(0,i.jsx)(n.td,{children:"id, severity, location, timestamp"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Congestion"})}),(0,i.jsx)(n.td,{children:"Congestion zone"}),(0,i.jsx)(n.td,{children:"id, level, duration, affected_roads"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Pattern"})}),(0,i.jsx)(n.td,{children:"Traffic pattern"}),(0,i.jsx)(n.td,{children:"id, type, frequency, time_of_day"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"relationship-types",children:"Relationship Types"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Relationship"}),(0,i.jsx)(n.th,{children:"From"}),(0,i.jsx)(n.th,{children:"To"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"OBSERVES"})}),(0,i.jsx)(n.td,{children:"Camera"}),(0,i.jsx)(n.td,{children:"Observation"}),(0,i.jsx)(n.td,{children:"Camera captures observation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DETECTS"})}),(0,i.jsx)(n.td,{children:"Camera"}),(0,i.jsx)(n.td,{children:"Accident"}),(0,i.jsx)(n.td,{children:"Camera detects accident"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CAUSES"})}),(0,i.jsx)(n.td,{children:"Accident"}),(0,i.jsx)(n.td,{children:"Congestion"}),(0,i.jsx)(n.td,{children:"Accident causes congestion"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CORRELATES_WITH"})}),(0,i.jsx)(n.td,{children:"Pattern"}),(0,i.jsx)(n.td,{children:"Pattern"}),(0,i.jsx)(n.td,{children:"Pattern correlation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NEAR_TO"})}),(0,i.jsx)(n.td,{children:"Camera"}),(0,i.jsx)(n.td,{children:"Camera"}),(0,i.jsx)(n.td,{children:"Spatial proximity"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"-architecture",children:"\ud83d\udd27 Architecture"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  NGSI-LD        \u2502\u2500\u2500\u2500\u25b6\u2502   Neo4j Sync    \u2502\r\n\u2502  Entities       \u2502    \u2502     Agent       \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                                \u2502\r\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n                    \u25bc           \u25bc           \u25bc\r\n             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n             \u2502  Create  \u2502 \u2502  Update  \u2502 \u2502  Delete  \u2502\r\n             \u2502  Nodes   \u2502 \u2502  Props   \u2502 \u2502  Nodes   \u2502\r\n             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                    \u2502           \u2502           \u2502\r\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                                \u25bc\r\n                       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n                       \u2502     Neo4j      \u2502\r\n                       \u2502   Database     \u2502\r\n                       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-usage",children:"\ud83d\ude80 Usage"}),"\n",(0,i.jsx)(n.h3,{id:"basic-synchronization",children:"Basic Synchronization"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from src.agents.graph_database.neo4j_sync_agent import Neo4jSyncAgent\r\n\r\nconfig = {\r\n    "enabled": True,\r\n    "neo4j_uri": "bolt://localhost:7687",\r\n    "username": "neo4j",\r\n    "password": "password"\r\n}\r\nsync_agent = Neo4jSyncAgent(config)\r\n\r\n# Sync camera entity\r\ncamera = {\r\n    "id": "urn:ngsi-ld:Camera:CAM_001",\r\n    "type": "Camera",\r\n    "name": {"value": "Camera 001"},\r\n    "location": {\r\n        "value": {\r\n            "coordinates": [106.660172, 10.762622]\r\n        }\r\n    }\r\n}\r\nsync_agent.sync_entity(camera)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"batch-synchronization",children:"Batch Synchronization"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Sync multiple entities\r\nentities = [camera1, camera2, camera3]\r\nsync_agent.sync_entities(entities)\r\n\r\n# Sync with relationships\r\nsync_agent.sync_with_relationships(\r\n    entity=observation,\r\n    relationships=[\r\n        ("OBSERVED_BY", camera_id),\r\n        ("PART_OF", pattern_id)\r\n    ]\r\n)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"query-graph",children:"Query Graph"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Find all accidents near a camera\r\nresults = sync_agent.query("""\r\n    MATCH (c:Camera {id: $camera_id})-[:DETECTS]->(a:Accident)\r\n    WHERE a.severity = \'severe\'\r\n    RETURN a\r\n    ORDER BY a.timestamp DESC\r\n    LIMIT 10\r\n""", {"camera_id": "CAM_001"})\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-configuration",children:"\u2699\ufe0f Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"NEO4J_URL=bolt://localhost:7687\r\nNEO4J_USER=neo4j\r\nNEO4J_PASSWORD=your_password\n"})}),"\n",(0,i.jsx)(n.h3,{id:"yaml-configuration",children:"YAML Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# config/neo4j_sync.yaml\r\nneo4j:\r\n  enabled: true\r\n  uri: bolt://localhost:7687\r\n  username: neo4j\r\n  password: ${NEO4J_PASSWORD}\r\n  \r\n  pool:\r\n    max_size: 50\r\n    acquisition_timeout: 30\r\n  \r\n  sync:\r\n    batch_size: 100\r\n    create_indexes: true\r\n    \r\n  indexes:\r\n    - label: Camera\r\n      property: id\r\n    - label: Observation\r\n      property: timestamp\r\n    - label: Accident\r\n      property: severity\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-cypher-query-examples",children:"\ud83d\udcc8 Cypher Query Examples"}),"\n",(0,i.jsx)(n.h3,{id:"find-traffic-patterns",children:"Find Traffic Patterns"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cypher",children:"// Find cameras with high accident rates\r\nMATCH (c:Camera)-[:DETECTS]->(a:Accident)\r\nWITH c, count(a) as accident_count\r\nWHERE accident_count > 5\r\nRETURN c.name, accident_count\r\nORDER BY accident_count DESC\n"})}),"\n",(0,i.jsx)(n.h3,{id:"spatial-queries",children:"Spatial Queries"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cypher",children:"// Find cameras within 1km radius\r\nMATCH (c1:Camera), (c2:Camera)\r\nWHERE c1.id <> c2.id\r\nAND point.distance(\r\n    point({longitude: c1.lon, latitude: c1.lat}),\r\n    point({longitude: c2.lon, latitude: c2.lat})\r\n) < 1000\r\nRETURN c1.name, c2.name\n"})}),"\n",(0,i.jsx)(n.h3,{id:"pattern-correlation",children:"Pattern Correlation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cypher",children:"// Find correlated congestion patterns\r\nMATCH (p1:Pattern)-[:CORRELATES_WITH]->(p2:Pattern)\r\nWHERE p1.type = 'morning_rush'\r\nRETURN p1, p2, p1.correlation_score\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-error-handling",children:"\ud83d\udee1\ufe0f Error Handling"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'try:\r\n    sync_agent.sync_entity(entity)\r\nexcept ConnectionError:\r\n    logger.error("Neo4j connection failed")\r\n    # Fallback to queue for retry\r\n    retry_queue.add(entity)\r\nexcept ConstraintError:\r\n    logger.warning("Duplicate entity, updating instead")\r\n    sync_agent.update_entity(entity)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"-related-documentation",children:"\ud83d\udcd6 Related Documentation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"neo4j-query",children:"Neo4j Query Agent"})," - Graph query operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../context-management/entity-publisher",children:"Entity Publisher Agent"})," - Entity source"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../rdf-linked-data/triplestore-loader",children:"Triplestore Loader"})," - RDF storage"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:["See the ",(0,i.jsx)(n.a,{href:"../complete-agents-reference",children:"complete agents reference"})," for all available agents."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>c});var t=r(6540);const i={},a=t.createContext(i);function s(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);